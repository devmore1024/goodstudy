# A3a 学生建档对话

## 页面信息
- **所属模块**：登录注册模块
- **页面类型**：全屏页
- **数字人老师**：大/居中
- **支持模式**：学生

## 线框图

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ←                              跳过    |
|                                        |
|           +------------+               |
|           |   数字人   |               |
|           |   老师     |               |
|           |  (上半身)  |               |
|           | 160x200pt  |               |
|           +------------+               |
|                                        |
|  +------------------------------------+|
|  | 🌸 你叫什么名字呀？我想认识你~    ||
|  +------------------------------------+|
|                                        |
|                    +------------------+|
|                    | 我叫小明 🗣️      ||
|                    +------------------+|
|                                        |
|  +------------------------------------+|
|  | 🌸 小明你好！你现在上几年级啦？    ||
|  +------------------------------------+|
|                                        |
|  +------------------------------------+|
|  |  请选择年级                         ||
|  |  +------+ +------+ +------+        ||
|  |  | 一年级| | 二年级| | 三年级|       ||
|  |  +------+ +------+ +------+        ||
|  |  +------+ +------+ +------+        ||
|  |  | 四年级| | 五年级| | 六年级|       ||
|  |  +------+ +------+ +------+        ||
|  |  +------+ +------+ +------+        ||
|  |  | 初一  | | 初二  | | 初三  |       ||
|  |  +------+ +------+ +------+        ||
|  |  +------+ +------+ +------+        ||
|  |  | 高一  | | 高二  | | 高三  |       ||
|  |  +------+ +------+ +------+        ||
|  +------------------------------------+|
|                                        |
|  +------------------------------------+|
|  | 🌸 我帮你整理好了，看看对不对~    ||
|  |                                    ||
|  | +--------------------------------+ ||
|  | | 你的学习档案                     | ||
|  | | ─────────────────────────────── | ||
|  | | 姓名      小明                  | ||
|  | | 年级      三年级                | ||
|  | | 城市      杭州                  | ||
|  | | 声纹      已录入 ✓              | ||
|  | | ─────────────────────────────── | ||
|  | | +------------+ +--------------+ | ||
|  | | | 我要修改   | |  确认无误    | | ||
|  | | +------------+ +--------------+ | ||
|  | +--------------------------------+ ||
|  +------------------------------------+|
|                                        |
|  ◉ 声纹采集 ████████████ 100% ✓       |
|                                        |
|          +--------------------+        |
|          |  🎤 按住说话       |        |
|          +--------------------+        |
|                                        |
+----------------------------------------+
```

## 元素说明

### 1. 导航栏
- **位置**：页面顶部
- **左侧**：返回箭头，点击返回 A3 重新选择身份
- **右侧**：「跳过」文字按钮，字号 14pt，颜色 #999999
- **样式**：透明背景

### 2. 数字人老师形象
- **位置**：导航栏下方居中
- **初始尺寸**：96 × 96 pt 圆形（upper 模式），白色描边 ring-3、阴影 shadow-xl、半透明光晕
- **缩小后**：40 × 40 pt 圆形（avatar 模式），白色描边 ring-2、阴影 shadow-md
- **内容**：小花老师真实卡通头像图片（`/images/teacher.png`）
- **说明**：用户首次回答后，头像自动缩小至 avatar 模式以留出更多对话空间
- **背景**：页面使用 page-bg-chat 渐变背景，带半透明装饰圆形

### 3. 对话消息列表
- **位置**：数字人形象下方，占据中间主体区域
- **布局**：垂直滚动列表，类似聊天界面
- **AI 消息**（左对齐）：
  - 头像：小花图标，32 × 32 pt，圆形
  - 气泡：白色背景，圆角 12pt（左上角方角），左侧边距 24pt，右侧边距 80pt
  - 文字：字号 15pt，颜色 #333333，行高 1.5
- **用户消息**（右对齐）：
  - 气泡：品牌浅色背景 #FFF5F0，圆角 12pt（右上角方角），右侧边距 24pt，左侧边距 80pt
  - 文字：字号 15pt，颜色 #333333
  - 来源标记：气泡右下角小字标记「语音」或「文字」
- **滚动行为**：新消息出现时自动滚动到底部

### 4. 嵌入式结构化选择器

#### 年级选择器
- **触发**：AI 询问年级后在对话流中嵌入
- **样式**：嵌入在对话气泡内的网格选择器
- **布局**：3 列网格，每个选项 96 × 40 pt
- **分组**：
  - 小学（一至六年级）
  - 初中（初一至初三）
  - 高中（高一至高三）
- **每组标题**：字号 12pt，颜色 #999999，分组间距 12pt
- **选项样式**：
  - 默认：白色背景，圆角 8pt，1px 边框 #E5E5E5，字号 14pt
  - 选中：品牌色背景 #FF7A45，白色文字，轻微弹跳动画
- **交互**：点击选择，也可语音说「我上三年级」等

#### 城市选择器
- **触发**：AI 询问所在城市后嵌入
- **样式**：搜索框 + 热门城市 + 滚轮选择器
- **搜索框**：圆角输入框，placeholder「搜索城市」，带搜索图标
- **热门城市**：横向排列常见城市标签，可点击选择
- **滚轮选择器**：省份-城市二级联动滚轮

### 5. 档案确认卡片
- **触发**：所有信息收集完毕 + 声纹采集完成后，嵌入对话气泡中
- **位置**：嵌入在 AI 对话气泡内
- **样式**：白色卡片，圆角 12pt，内边距 16pt
- **内容**：
  - 标题：「你的学习档案」，字号 16pt，字重 Medium，颜色 #333333
  - 分隔线：1px #F0F0F0
  - 信息行（每行）：
    - 标签：字号 13pt，颜色 #999999（如「姓名」「年级」「城市」「声纹状态」）
    - 值：字号 15pt，颜色 #333333
    - 行高 40pt，行间距 0
  - 声纹状态行：值显示绿色「已录入 ✓」，颜色 #52C41A
- **底部按钮**：
  - 两列等宽，间距 12pt
  - 「我要修改」：白色背景，品牌色文字，1px 品牌色边框，圆角 8pt，高 40pt
  - 「确认无误」：品牌色背景，白色文字，圆角 8pt，高 40pt
- **交互**：
  - 点击「确认无误」或语音说「没问题」→ 建档完成
  - 点击「我要修改」→ AI 询问修改项，重新展开对应选择器

### 6. 声纹采集进度条
- **位置**：对话区域下方，语音按钮上方
- **样式**：同 A3 页面声纹采集进度条
- **说明**：延续 A3 的采集进度，继续在对话中累积
- **完成后**：显示「声纹已采集完成 ✓」绿色文字，2 秒后收起

### 7. 底部固定输入栏（ChatInputBar）
- **位置**：页面底部固定
- **布局**：左侧语音/键盘切换按钮 + 中间输入区 + 右侧扩展按钮
- **文字模式**：圆角 16pt 输入框（placeholder「请输入...」）+ 品牌绿圆形发送按钮（有内容时激活并带发光阴影）
- **语音模式**：「按住说话」按钮，按住后变为「松开发送」并高亮品牌色边框
- **切换按钮**：麦克风图标（切换到语音）/ 键盘图标（切换到文字），36pt 圆形
- **背景**：毛玻璃效果（glass: rgba(255,255,255,0.75) + backdrop-blur 12px），顶部 1px 分隔线
- **显示条件**：当前步骤输入类型为 text 时显示；tag-select / voiceprint / card 等输入类型时隐藏（这些输入仍在对话区域内联渲染）
- **禁用状态**：AI 正在打字时输入栏禁用（灰色背景，不可输入）

## 交互行为

### 手势交互
- **上下滑动**：滚动对话列表
- **按住说话**：长按语音按钮录音
- **上滑取消**：取消当前语音输入
- **点击选择器选项**：选择年级/城市
- **左滑返回**：返回 A3（需确认「确定要返回吗？当前信息将不保存」）
- **下拉对话列表**：查看之前的对话内容

### 输入交互
- **语音输入**：同 A3 的语音输入逻辑
- **文字输入**：键盘输入，回车发送
- **选择器交互**：
  - 年级：单选点击
  - 城市：搜索或滚轮选择
- **修改已回答内容**：对已回答的问题，可点击对应气泡旁的「修改」按钮，重新出现选择器或可编辑状态

### 动画与反馈
- **AI 消息出现**：气泡从左侧滑入 + 淡出，文字逐字显示
- **用户消息出现**：气泡从右侧滑入
- **选择器展开**：从气泡底部展开，高度由 0 过渡到完整高度，时长 300ms
- **选项选中**：轻微缩放弹跳 + 品牌色填充过渡
- **档案确认卡片出现**：卡片从气泡内展开，信息行依次从上到下淡入，每行延迟 100ms
- **建档完成**：数字人鼓掌 + 撒花粒子动画 + 语音「太棒了！你的学习档案已经建好了~」
- **进度反馈**：对话区域顶部显示步骤指示器（如 1/4、2/4），跟随对话进度

### AI 老师交互

#### 对话流程
1. **询问姓名**：「你叫什么名字呀？我想认识你~」
   - 期待回答：语音/文字输入姓名
   - AI 确认：「[姓名]，真好听！」
   - 容错：若未识别到姓名，追问「没听清楚，能再说一遍你的名字吗？」

2. **询问年级**：「你现在上几年级啦？」
   - 同时展开年级选择器
   - 支持语音回答如「我上三年级」
   - AI 确认：「[年级]的同学你好！」

3. **询问城市**：「你在哪个城市上学呢？」
   - 展开城市选择器
   - 支持语音回答城市名
   - AI 确认：「[城市]是个好地方！」

4. **声纹最终采集**（若此前未完成）：「最后，请你随便说几句话，让我记住你的声音~」
   - 提示用户连续说话 5-10 秒
   - 可以提供话题引导：「比如说说你最喜欢的动画片？」
   - 学生声纹采集完成 = 学生建档完成的必要条件

5. **档案确认**：
   - 建档完成条件：基本信息收集完毕（姓名、年级、城市）+ 学生声纹采集完成
   - 学生可独立完成整个建档流程，不依赖家长声纹录入
   - AI 提示：「我帮你整理好了，你看看对不对~」
   - 在对话气泡中嵌入档案信息卡片，展示已收集的全部信息：
     - 姓名：[姓名]
     - 年级：[年级]
     - 城市：[城市]
     - 声纹状态：已录入 ✓
   - 卡片底部显示两个按钮：「确认无误」/「我要修改」
   - 用户点击「我要修改」→ AI 回应「没问题，你想修改哪一项呢？」→ 用户语音/点击指定字段 → 重新展开对应选择器
   - 用户点击「确认无误」或语音说「没问题」→ 进入第 6 步

6. **建档完成**：
   - AI 提示：「太棒了！你的学习档案已经建好了~」
   - AI 补充提示：「你可以告诉爸爸妈妈也来注册，这样他们就能看到你的学习报告了~」（非强制，仅提示）
   - 显示两个操作按钮：「上传试卷」和「直接开始」

#### 身份纠错
- 对话中用户说「我其实是家长」，AI 识别后询问「您想切换到家长模式吗？」
- 用户确认后返回 A3，以家长身份重新进入 A3b 建档流程
- 顶部导航「返回」可回到 A3 重新进行身份判断

#### 对话回退修改
- 对话中显示「修改」按钮在每个已确认的回答旁
- 点击修改后，AI 回应「没问题，我们重新选一下」
- 重新展开对应的选择器
- 修改确认后，档案确认卡片中的信息同步更新

#### 声纹采集交互
- 用户每次语音输入时同步采集声纹特征
- 进度条实时更新
- 当采集进度达到 100% 时：
  - 进度条显示完成状态
  - AI 语音提示「我已经记住你的声音啦！下次你一说话我就知道是你~」
  - 短暂震动反馈

## 状态枚举

### 默认状态
- 数字人老师居中展示
- 自动开始第一轮对话（询问姓名）
- 声纹采集进度延续 A3 的进度
- 语音输入模式

### 空状态
- 不适用

### 加载状态
- **语音识别中**：用户消息气泡显示波形动画 + 「识别中...」
- **AI 思考中**：AI 气泡显示跳动的三个点
- **选择器数据加载**：城市列表加载时显示骨架屏
- **建档信息提交中**：显示全屏半透明加载遮罩 + 「正在为你创建学习档案...」

### 错误状态
- **语音识别失败**：AI 回应「没听清楚，可以再说一遍吗？或者你也可以用文字告诉我~」
- **姓名识别异常**：AI 追问「你的名字是[识别结果]吗？」提供确认/重新输入选项
- **网络断开**：顶部红色横幅提示，未发送的消息显示红色感叹号，可点击重发
- **建档提交失败**：弹窗「档案创建失败，请重试」+ 重试按钮
- **声纹采集失败**：提示「声纹采集遇到问题，我们之后再试」，允许跳过

### 边界情况
- **用户输入超长姓名**：限制 20 个字符，超出截断并提示
- **用户选择高年级后切回低年级**：允许修改，无额外影响
- **用户快速跳过所有步骤**：点击「跳过」弹出确认弹窗，确认后跳转 B1，标记档案为「未完善」
- **对话中途退出应用**：保存对话进度，下次进入继续
- **城市搜索无结果**：显示「未找到该城市」，提供手动输入选项
- **用户反复修改**：每个字段最多修改 5 次，超过后提示「你可以在设置中继续修改」
- **声纹环境不适合**：检测到持续噪音时，提示切换文字模式，声纹后续补采

## 导航关系

### 从哪来
- A3 AI 老师欢迎对话页（选择学生身份后跳转）

### 到哪去
- **建档完成 + 选择上传试卷** → A4 试卷拍照上传页
- **建档完成 + 选择直接开始** → B1 学生首页
- **点击跳过** → B1 学生首页（档案未完善状态）
- **点击返回** → A3 AI 老师欢迎对话页
