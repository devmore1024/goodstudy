# D3 实时答疑

## 页面信息
- **所属模块**：D-核心学习模块
- **页面类型**：全屏页
- **数字人老师**：大/居中（页面顶部对话区域内以消息气泡形式出现）
- **支持模式**：学生

## 线框图

### 默认对话状态

```
┌──────────────────────────────────┐
│ ← 实时答疑 · 数学     ⋮        │
├──────────────────────────────────┤
│                                  │
│  ┌─────────────────────┐        │
│  │ 🌸 小花老师          │        │
│  │ 你好呀！有什么不     │        │
│  │ 明白的题目吗？可以   │        │
│  │ 拍照或者打字告诉我~  │        │
│  └─────────────────────┘        │
│                                  │
│        ┌─────────────────────┐  │
│        │ 老师，这道应用题    │  │
│        │ 不会做               │  │
│        └─────────────────────┘  │
│        ┌─────────────────────┐  │
│        │ 📷 [应用题图片]     │  │
│        └─────────────────────┘  │
│                                  │
│  ┌─────────────────────┐        │
│  │ 🌸 小花老师          │        │
│  │ 我看看~这是一道行    │        │
│  │ 程问题呢。你先想想   │        │
│  │ 看，题目里提到了     │        │
│  │ 哪些已知条件？       │        │
│  └─────────────────────┘        │
│                                  │
│  ┌──────────────────────────┐   │
│  │ 💡 引导提示卡片          │   │
│  │ 试着找出：               │   │
│  │ · 速度是多少？           │   │
│  │ · 时间是多少？           │   │
│  │ · 要求什么？             │   │
│  └──────────────────────────┘   │
│                                  │
├──────────────────────────────────┤
│ ┌────────────────┐ 🎤  📷      │
│ │ 输入消息...     │             │
│ └────────────────┘  发送        │
└──────────────────────────────────┘
```

### AI 思考中状态

```
┌──────────────────────────────────┐
│                                  │
│  ┌─────────────────────┐        │
│  │ 🌸 小花老师          │        │
│  │  · · ·  思考中       │        │
│  └─────────────────────┘        │
│                                  │
├──────────────────────────────────┤
│ ┌────────────────┐ 🎤  📷      │
│ │ 输入消息...     │             │
│ └────────────────┘  发送        │
└──────────────────────────────────┘
```

### 语音输入状态

```
┌──────────────────────────────────┐
│                                  │
│  （对话内容区域）                │
│                                  │
├──────────────────────────────────┤
│  ┌──────────────────────────┐   │
│  │                          │   │
│  │    ～～ 🎤 ～～          │   │
│  │    正在聆听...           │   │
│  │                          │   │
│  │  ┌──────────────────┐   │   │
│  │  │ 识别文字预览...   │   │   │
│  │  └──────────────────┘   │   │
│  │                          │   │
│  │  上滑取消    松开发送   │   │
│  │                          │   │
│  └──────────────────────────┘   │
└──────────────────────────────────┘
```

### 公式渲染消息

```
┌──────────────────────────────────┐
│                                  │
│  ┌─────────────────────┐        │
│  │ 🌸 小花老师          │        │
│  │ 这道题要用到公式：   │        │
│  │                      │        │
│  │   路程 = 速度 × 时间 │        │
│  │   S = v × t          │        │
│  │                      │        │
│  │ 已知 v=60km/h，      │        │
│  │ t=2.5h，那 S=?      │        │
│  └─────────────────────┘        │
│                                  │
└──────────────────────────────────┘
```

## 元素说明

| 元素 | 类型 | 说明 |
|------|------|------|
| 导航栏 | 顶部栏 | 返回按钮 + 标题"实时答疑" + 当前学科标签 + 更多菜单(⋮) |
| 老师消息气泡 | 聊天气泡 | 左对齐，带小花老师头像，浅紫色背景 |
| 学生消息气泡 | 聊天气泡 | 右对齐，浅蓝色背景 |
| 图片消息 | 嵌入式图片 | 气泡内显示缩略图，点击可全屏查看 |
| 公式消息 | 富文本消息 | 使用LaTeX渲染数学公式，支持行内和块级公式 |
| 引导提示卡片 | 卡片组件 | 黄色渐变背景卡片，列出思考引导点，带💡图标 |
| 思考动画 | 动画组件 | 三个圆点依次跳动，模拟打字效果 |
| 文本输入框 | 输入控件 | 底部左侧，单行输入，超长自动换行，最多4行 |
| 语音按钮 | 图标按钮 | 麦克风图标，长按进入语音输入模式 |
| 相机按钮 | 图标按钮 | 相机图标，点击拍照或选图发送 |
| 发送按钮 | 文本按钮 | 有输入内容时高亮显示，无内容时灰色 |
| 语音输入面板 | 浮层 | 长按麦克风后从底部弹出，显示音波动画和实时识别文字 |
| 知识点链接 | 内联链接 | 消息中蓝色下划线文本，点击跳转知识点精讲 |

## 交互行为

### 手势交互
- **上下滚动**：滚动查看历史对话记录，新消息自动滚动到底部
- **长按消息气泡**：弹出操作菜单（复制文本 / 收藏 / 朗读）
- **长按麦克风按钮**：进入语音输入模式，松开发送，上滑取消
- **点击图片消息**：全屏预览图片，支持双指缩放
- **下拉到顶部**：加载更早的历史消息

### 输入交互
- **文本输入**：底部输入框输入文字，点击"发送"或键盘回车发送
- **语音输入**：长按麦克风按钮录音，松开后自动转文字发送；识别文字实时预览
- **拍照输入**：点击相机按钮，拍照或从相册选择图片发送
- **点击引导卡片中的选项**：将选项内容自动填入输入框
- **点击知识点链接**：跳转到D4知识点精讲页面
- **点击更多菜单(⋮)**：显示"清空对话 / 切换学科 / 查看学习报告"

### 动画与反馈
- **消息发送动画**：学生消息从右侧滑入，老师消息从左侧滑入，200ms缓动
- **思考中动画**：三个圆点（·）依次上下跳动，周期800ms循环
- **语音输入音波**：麦克风周围显示随声音大小变化的同心圆波纹
- **引导卡片出现**：从下方弹入+轻微弹跳效果
- **消息长按震动**：长按气泡时轻微震动反馈
- **公式渲染**：LaTeX公式先显示原始文本，0.5秒内替换为渲染后的公式
- **语音转文字**：实时显示语音识别结果，文字逐字出现

### AI 老师交互
- **首次进入**：小花老师语音"你好呀！有什么不明白的题目吗？可以拍照或者打字告诉我~"
- **引导式教学**：小花老师不会直接给出答案，而是通过提问和提示引导学生思考
- **多轮对话**：小花老师根据学生回答动态调整引导方向和难度
- **鼓励反馈**：学生回答正确时"太棒了！你理解得很对！"；回答错误时"再想想看，提示一下……"
- **知识点关联**：对话中涉及的知识点，小花老师主动提供知识点精讲链接
- **语音播报**：每条老师消息自动语音播报（可在设置中关闭）
- **超出能力范围**：无法回答的问题，老师回复"这个问题有点超出我的范围，建议问问你的老师哦"

## 状态枚举

### 默认状态
- 显示小花老师欢迎消息
- 输入框获取焦点提示输入
- 如从D2跳转而来，自动显示带入的题目图片和问题

### 空状态
- 场景：无历史对话记录
- 展示：小花老师居中大图 + 欢迎语 + 推荐提问示例卡片（"试试问我这些问题…"）
- 推荐问题可点击直接发送

### 加载状态
- **AI思考中**：显示打字动画气泡（三个跳动圆点），输入框仍可输入但发送按钮置灰
- **历史消息加载**：顶部显示加载旋转图标
- **图片上传中**：图片消息气泡内显示上传进度百分比

### 错误状态
- **AI响应超时**：10秒无响应，显示"小花老师思考太久了" + "重试"按钮
- **网络断开**：底部输入栏上方红色条幅"网络已断开，请检查网络连接"
- **语音识别失败**：提示"没有听清楚，请再说一次"
- **图片发送失败**：图片气泡右下角显示红色感叹号，点击重发

### 边界情况
- **对话轮数上限**：单次对话最多100轮，接近上限提示"对话较长，建议开启新对话"
- **消息长度限制**：单条消息最多500字，超出提示"消息太长了，试试分开发送吧"
- **并发消息**：AI回复未完成时再次发送，新消息排队等待上一轮回复完成后处理
- **敏感内容过滤**：检测到与学习无关内容，老师回复"我们还是专注学习吧~有什么题目需要帮忙吗？"
- **公式输入**：学生输入简单数学表达式（如 3/4+1/2）自动识别并渲染为公式
- **跨学科提问**：自动检测学科并切换对应的知识库，顶部学科标签同步更新

## 导航关系

### 从哪来
- **D1-每日学习主页**：点击底部导航"答疑"Tab，或点击小花老师头像发起提问
- **D2-拍照判题**：点击"问小花老师这道题"按钮，携带题目信息进入
- **B1-首页**：点击首页"问老师"快捷入口

### 到哪去
- **D4-知识点精讲**：点击对话中出现的知识点链接，跳转到对应知识点精讲
