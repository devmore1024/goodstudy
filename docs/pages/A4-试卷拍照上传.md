# A4 试卷拍照上传

## 页面信息
- **所属模块**：学情诊断模块
- **页面类型**：全屏页
- **数字人老师**：小/右上角悬浮（入口引导状态为大/居中）
- **支持模式**：学生

## 线框图

### 状态零：入口引导界面

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ← 学情了解                             |
|                                        |
|        ┌──────────────┐                |
|        │              │                |
|        │   数字人老师  │                |
|        │  （大/居中）  │                |
|        │   说话动画    │                |
|        └──────────────┘                |
|                                        |
|  ┌──────────────────────────────────┐  |
|  │ "上传最近的考试试卷可以帮助我     │  |
|  │  更好地了解你的学习情况哦~       │  |
|  │  你有试卷想给我看看吗？"         │  |
|  └──────────────────────────────────┘  |
|                                        |
|  ┌──────────────────────────────────┐  |
|  │       📄 我有试卷，拍给你看       │  |
|  └──────────────────────────────────┘  |
|                                        |
|  ┌──────────────────────────────────┐  |
|  │       🙅 我没有试卷              │  |
|  └──────────────────────────────────┘  |
|                                        |
+----------------------------------------+
```

### 状态一：拍照取景界面

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ← 试卷拍照                     [小花] |
|                                        |
|  +------------------------------------+|
|  |                                    ||
|  |     📷 相机取景区域                ||
|  |                                    ||
|  |   +----------------------------+   ||
|  |   |                            |   ||
|  |   |    试卷对齐引导框          |   ||
|  |   |    (白色虚线矩形)          |   ||
|  |   |                            |   ||
|  |   |   请将试卷放入框内         |   ||
|  |   |                            |   ||
|  |   |                            |   ||
|  |   |                            |   ||
|  |   +----------------------------+   ||
|  |                                    ||
|  |   自动检测边缘中...               ||
|  |                                    ||
|  +------------------------------------+|
|                                        |
|  已拍 1/10 页                          |
|  +----+ +----+ +----+                 |
|  | P1 | | P2 | | ＋ |                 |
|  +----+ +----+ +----+                 |
|                                        |
|   [相册]    (●)拍照     [完成(1)]     |
|                                        |
+----------------------------------------+
```

### 状态二：裁剪调整界面

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ← 裁剪调整                            |
|                                        |
|  +------------------------------------+|
|  |                                    ||
|  |   ○--------------------------○    ||
|  |   |                          |    ||
|  |   |   拍摄的试卷图片         |    ||
|  |   |   (可拖动四角调整裁剪)   |    ||
|  |   |                          |    ||
|  |   |                          |    ||
|  |   |                          |    ||
|  |   |                          |    ||
|  |   ○--------------------------○    ||
|  |                                    ||
|  +------------------------------------+|
|                                        |
|  +--------+ +--------+ +--------+     |
|  | 旋转↻  | | 自动裁剪| | 重拍 ↺ |    |
|  +--------+ +--------+ +--------+     |
|                                        |
|  +------------------------------------+|
|  |           确认使用                 ||
|  +------------------------------------+|
|                                        |
+----------------------------------------+
```

### 状态三：试卷信息填写

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ← 试卷信息                     [小花] |
|                                        |
|  已上传照片预览                        |
|  +----+ +----+ +----+                 |
|  | P1 | | P2 | | P3 |                 |
|  +----+ +----+ +----+                 |
|                                        |
|  +------------------------------------+|
|  | 考试类型                            ||
|  | +---------+ +--------+ +--------+ ||
|  | | 期中考试 | | 期末考试| | 单元测试| ||
|  | +---------+ +--------+ +--------+ ||
|  | +--------+ +--------+             ||
|  | | 月考   | | 模拟考 |             ||
|  | +--------+ +--------+             ||
|  +------------------------------------+|
|                                        |
|  +------------------------------------+|
|  | 科目                                ||
|  | +---------+ +--------+ +--------+ ||
|  | |  语文   | | [数学]  | |  英语   | ||
|  | +---------+ +--------+ +--------+ ||
|  +------------------------------------+|
|                                        |
|  +------------------------------------+|
|  | 考试时间  [  2026年2月       ▼ ]   ||
|  +------------------------------------+|
|                                        |
|  +------------------------------------+|
|  | 总分    [  100  ] 得分  [  85  ]   ||
|  +------------------------------------+|
|                                        |
|  +------------------------------------+|
|  |         开始识别分析               ||
|  +------------------------------------+|
|                                        |
+----------------------------------------+
```

### 状态四：OCR 识别结果

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ← 识别结果                     [小花] |
|                                        |
|  AI识别完成，请确认以下信息：          |
|                                        |
|  +------------------------------------+|
|  | 第1题 ✓ 正确                       ||
|  | 填空题：3 + 5 = [8]                ||
|  +------------------------------------+|
|  | 第2题 ✗ 错误                       ||
|  | 选择题：以下哪个是质数？            ||
|  | 你的答案：B    正确答案：C          ||
|  | [ 修改识别结果 ]                    ||
|  +------------------------------------+|
|  | 第3题 ⚠ 需确认                     ||
|  | 识别不清晰，请确认答案             ||
|  | 识别结果：[  42  ] → 点击修改      ||
|  +------------------------------------+|
|  | ...                                ||
|  +------------------------------------+|
|                                        |
|  识别准确率：92%  共15题               |
|  正确：12题  错误：2题  待确认：1题    |
|                                        |
|  +------------------------------------+|
|  |          确认识别结果               ||
|  +------------------------------------+|
|                                        |
+----------------------------------------+
```

### 状态五：多科目连续上传引导

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
| ← 继续上传                     [小花] |
|                                        |
|        ┌──────────────┐                |
|        │   数字人老师  │                |
|        │  （小/右上）  │                |
|        └──────────────┘                |
|                                        |
|  ┌──────────────────────────────────┐  |
|  │ "数学试卷我看完啦！              │  |
|  │  还有其他科目的试卷要上传吗？"   │  |
|  └──────────────────────────────────┘  |
|                                        |
|  已上传科目：                          |
|  ┌──────┐                              |
|  │✓ 数学│                              |
|  └──────┘                              |
|                                        |
|  ┌──────────────────────────────────┐  |
|  │       📄 上传语文试卷             │  |
|  └──────────────────────────────────┘  |
|  ┌──────────────────────────────────┐  |
|  │       📄 上传英语试卷             │  |
|  └──────────────────────────────────┘  |
|  ┌──────────────────────────────────┐  |
|  │       ✅ 没有了，下一步           │  |
|  └──────────────────────────────────┘  |
|                                        |
+----------------------------------------+
```

## 元素说明

### 0. 入口引导界面（状态零）

#### 数字人老师区域
- **位置**：页面居中偏上
- **尺寸**：144 × 144 pt 圆形（full 模式），真实卡通头像图片
- **样式**：白色描边 ring-4、大阴影 shadow-2xl、呼吸缩放动画、脉冲光环、半透明渐变光晕
- **动画**：呼吸缩放动画 + 脉冲光环

#### AI 对话气泡
- **位置**：数字人老师下方
- **内容**：「欢迎！我可以帮你分析试卷，找出薄弱知识点。你手边有试卷吗？」
- **样式**：左侧小花头像（36pt 圆形，带光晕）+ 白色气泡（圆角 16pt），投影 `0 2px 12px rgba(0,0,0,0.06)`，左侧三角箭头

#### 选项按钮
- **位置**：对话气泡下方，垂直排列
- **「我有试卷」**：
  - 样式：品牌绿背景，白色文字，圆角 16pt，高 52pt，品牌色发光阴影 btn-glow-brand
  - 点击 → 进入状态一（拍照取景界面，默认科目数学）
- **「我没有试卷」**：
  - 样式：白色背景，品牌绿边框 2px，品牌色文字，圆角 16pt，高 52pt，shadow-sm
  - 点击 → 直接跳转学生首页

#### 页面背景
- **样式**：温暖渐变背景 page-bg-warm，半透明装饰圆形（右上角橙色/5、左下角品牌绿/5）

### 1. 导航栏
- **位置**：页面顶部
- **左侧**：返回箭头 + 标题文字（随状态变化：「学情了解」/「试卷拍照」/「裁剪调整」/「试卷信息」/「识别结果」/「继续上传」）
- **右侧**：小花老师头像（48 × 48 pt，圆形，拍照界面/信息填写/结果界面/继续上传界面显示；入口引导状态不显示，因数字人在居中区域）
- **样式**：入口引导和拍照状态为深色半透明背景，其他状态为白色背景

### 2. 相机取景区域（拍照状态）
- **位置**：导航栏下方，占据页面主体
- **内容**：实时相机画面
- **引导框**：
  - 白色虚线矩形，圆角 8pt，A4 纸比例（约 1:1.41）
  - 四角有明显的 L 型角标（品牌色，3pt 宽，20pt 长）
  - 引导文字「请将试卷放入框内」居中显示，白色半透明背景标签
- **自动边缘检测**：
  - 检测到试卷边缘时，引导框变为实线 + 绿色
  - 框随检测到的边缘实时变形贴合
  - 底部提示文字变为「已检测到试卷，保持稳定」
  - 稳定 1.5 秒后可自动拍摄（设置项可关闭自动拍摄）

### 3. 已拍照缩略图条
- **位置**：相机区域下方
- **布局**：水平滚动，左对齐
- **标题**：「已拍 N/10 页」，字号 13pt，颜色白色
- **缩略图**：
  - 尺寸：48 × 64 pt，圆角 4pt
  - 已拍页面显示缩略图 + 页码标签
  - 最后一个显示「+」号表示可继续拍摄
  - 点击缩略图可预览/删除该页
  - 长按可拖拽排序
- **数量限制**：最多 10 页

### 4. 底部操作栏（拍照状态）
- **位置**：页面底部安全区域上方
- **布局**：三等分，左中右对齐
- **左侧「相册」**：相册图标 + 文字，点击打开系统相册选择已有照片
- **中间拍照按钮**：
  - 尺寸：64 × 64 pt 圆形
  - 样式：白色外圈 3pt + 内部白色实心圆，间隔 4pt
  - 按下效果：内圆缩小至 0.85 倍
  - 拍照反馈：屏幕白色闪烁 100ms + 快门音
- **右侧「完成」**：品牌色文字 + 已拍数量角标，点击进入试卷信息填写

### 5. 裁剪调整区域（裁剪状态）
- **位置**：页面主体区域
- **内容**：拍摄的照片 + 可调整的裁剪框
- **裁剪框**：
  - 四角有可拖拽的圆形锚点（20pt 直径，品牌色填充，白色描边）
  - 边线为品牌色实线 2pt
  - 裁剪框外区域半透明黑色遮罩（opacity 0.5）
- **操作按钮行**：
  - 「旋转」：顺时针旋转 90 度
  - 「自动裁剪」：重新运行边缘检测自动裁剪
  - 「重拍」：丢弃当前照片回到拍照界面
- **确认按钮**：「确认使用」，品牌色渐变背景，白色文字

### 6. 试卷信息表单（信息填写状态）
- **位置**：导航栏下方，可滚动

#### 照片预览条
- 水平滚动缩略图列表，可点击预览大图

#### 考试类型选择
- **样式**：标签组，胶囊形按钮
- **选项**：期中考试、期末考试、单元测试、月考、模拟考、日常练习、其他
- **交互**：单选，默认不选中

#### 科目选择
- **样式**：标签组，胶囊形按钮（三选一）
- **选项**：固定为语文、数学、英语
- **交互**：单选，默认不选中
- **说明**：若从多科目连续上传引导（状态五）进入，科目自动预选为对应科目且不可修改

#### 考试时间选择
- **样式**：日期选择器（年月）
- **默认值**：当前月份
- **范围**：过去 12 个月至当前月份

#### 分数输入
- **布局**：两个输入框并排
- **总分输入**：数字键盘，默认 100，范围 1-999
- **得分输入**：数字键盘，无默认值，范围 0-总分值
- **校验**：得分不得超过总分，超出时输入框变红 + 提示

#### 开始识别按钮
- **样式**：品牌色渐变，圆角 24pt，高 48pt
- **激活条件**：至少选择考试类型和科目
- **点击后**：按钮变为进度条样式，显示 OCR 处理进度

### 7. OCR 识别结果列表（结果状态）
- **位置**：导航栏下方，可滚动
- **标题提示**：「AI识别完成，请确认以下信息：」

#### 题目卡片
- **样式**：白色卡片，圆角 12pt，左侧有状态色条
  - 正确：绿色色条 #52C41A
  - 错误：红色色条 #FF4D4F
  - 待确认：黄色色条 #FAAD14
- **内容**：
  - 题号 + 状态标签
  - 题目内容（OCR 识别结果）
  - 学生答案 + 正确答案（错误题目）
  - 「修改识别结果」按钮（可点击编辑）
- **待确认项**：显示可编辑的输入框，让用户修正识别不清晰的内容

#### 统计摘要
- **位置**：列表底部
- **内容**：识别准确率、总题数、正确数、错误数、待确认数
- **样式**：灰色背景卡片，各项数据用不同颜色标注

#### 确认按钮
- **文字**：「确认识别结果」
- **样式**：品牌色渐变，圆角 24pt
- **激活条件**：所有「待确认」项已处理
- **点击后**：进入状态五（多科目连续上传引导）

### 8. 多科目连续上传引导（状态五）
- **位置**：全屏展示

#### AI 对话气泡
- **内容**：「[科目]试卷我看完啦！还有其他科目的试卷要上传吗？」
- **样式**：白色圆角气泡，字号 16pt

#### 已上传科目标签
- **位置**：对话气泡下方
- **样式**：绿色背景胶囊标签，带 ✓ 图标，展示已上传的科目名
- **布局**：水平排列

#### 剩余科目上传按钮
- **位置**：已上传标签下方，垂直排列
- **内容**：只显示尚未上传的科目按钮（如已传数学，只显示「上传语文试卷」「上传英语试卷」）
- **样式**：白色背景，品牌色边框，品牌色文字，圆角 24pt，高 48pt
- **左侧图标**：📄 文件图标
- **点击**：进入状态一（拍照取景界面），科目自动设为对应科目

#### 「没有了，下一步」按钮
- **位置**：剩余科目按钮下方
- **样式**：品牌色渐变背景，白色文字，圆角 24pt，高 48pt
- **左侧图标**：✅ 完成图标
- **点击**：跳转 C1 学习计划创建，携带已上传科目的诊断数据

## 交互行为

### 手势交互
- **拍照界面**：
  - 双指缩放：调整相机焦距
  - 点击对焦：点击取景区域任意位置进行对焦，显示对焦方框动画
- **裁剪界面**：
  - 拖拽四角锚点：调整裁剪范围
  - 双指旋转：微调图片角度（±15 度范围）
  - 双指缩放：放大查看细节
- **结果列表**：
  - 上下滑动：滚动题目列表
  - 点击题目卡片：展开/收起详情
  - 左滑题目卡片：显示「删除」操作（误识别的无效题目）

### 输入交互
- **分数输入**：仅数字键盘
- **修改识别结果**：弹出文字编辑弹窗，支持文字和数字输入
- **科目选择**：点击胶囊标签切换选中科目
- **时间选择**：系统原生选择器 / 自定义滚轮选择器
- **相册选择**：调用系统相册，支持多选（最多一次选 10 张）

### 动画与反馈
- **入口引导**：数字人老师从底部弹起 + 对话气泡逐字打字机效果 + 语音同步播放
- **自动边缘检测**：
  - 检测到边缘：引导框平滑变形贴合试卷，颜色从白色渐变为绿色
  - 未检测到：引导框持续显示虚线白色
  - 检测到但不稳定：引导框闪烁
- **拍照反馈**：屏幕白色闪光 + 快门音效 + 缩略图飞入底部预览条动画
- **裁剪锚点拖拽**：锚点附近有磁吸效果（靠近检测到的边缘时自动吸附）
- **OCR 处理进度**：
  - 全屏毛玻璃遮罩（glass 效果）
  - 居中显示小花老师头像（80pt 圆形，ring-3 白色描边，shadow-xl，呼吸动画）+ 品牌色脉冲光晕
  - 「正在识别试卷...」文字 + 进度条（52pt 宽，2.5pt 高，品牌色渐变填充，阴影内凹）+ 百分比
  - 底部 BouncingDots 加载指示器
  - 完成时跳转到识别结果页
- **识别结果出现**：题目卡片依次从底部滑入，每张间隔 50ms
- **多科目引导出现**：已上传科目标签弹入 + 剩余科目按钮依次从底部滑入
- **状态切换**：页面间采用共享元素过渡动画（照片从取景区域飞入裁剪区域）

### AI 老师交互
- **入口引导**：小花老师语音引导「上传最近的考试试卷可以帮助我更好地了解你的学习情况哦~ 你有试卷想给我看看吗？」
- **进入拍照界面**：小花老师语音引导「把试卷放平，对准框框拍照就好啦~」
- **拍照成功**：「拍得很清楚！还有其他页吗？」
- **照片模糊提醒**：「这张有点模糊，要不要重拍一张？」
- **OCR 处理中**：「我正在仔细看你的试卷，请稍等...」
- **OCR 完成**：「分析完成！你考了[得分]分，让我来看看哪些地方可以提升~」
- **发现薄弱点**：「我注意到你在[知识点]这块有些困难，我来帮你做个针对性计划吧！」
- **多科目引导**：「[科目]试卷我看完啦！还有其他科目的试卷要上传吗？」
- **全部上传完成**：「好的，我已经了解了你的情况，接下来我们一起制定学习计划吧！」
- **选择跳过（无试卷）**：「没关系！我们可以通过其他方式了解你的学习情况，一起来制定学习计划吧~」

## 状态枚举

### 默认状态
- 入口引导界面（状态零），数字人老师居中展示
- AI 对话气泡显示引导语，语音同步播放
- 两个选项按钮显示

### 空状态
- **无照片时**：拍照区域正常显示相机画面，缩略图条显示占位「拍摄试卷照片」
- **OCR 无法识别**：显示「未能识别试卷内容，请确保照片清晰」+ 「重新拍照」按钮

### 加载状态
- **相机启动中**：黑色背景 + 中心加载动画 + 「正在启动相机...」
- **照片处理中**：裁剪后显示「正在处理图片...」加载遮罩
- **OCR 识别中**：按钮区域显示进度条，页面上方显示旋转的分析动画
  - 进度分阶段：上传图片（0-30%）→ 文字识别（30-60%）→ 答案分析（60-90%）→ 结果整理（90-100%）
- **报告生成中**：全屏加载「正在生成分析报告...」

### 错误状态
- **相机权限未授权**：
  - 显示权限引导页面：相机图标 + 「需要相机权限来拍摄试卷」+ 「去设置」按钮
  - 同时显示「从相册选择」替代方案
- **相机硬件异常**：提示「相机不可用」，仅显示相册入口
- **照片过大/过小**：提示「照片尺寸不合适」+ 建议
- **OCR 识别失败**：提示「识别失败，请重试」+ 「重试」/「重新拍照」按钮
- **网络错误**：提示「网络不稳定，无法上传」+ 「重试」按钮
- **服务端超时**：提示「处理超时，请稍后再试」
- **分数输入校验错误**：得分 > 总分时，输入框红色边框 + 下方提示「得分不能超过总分」

### 边界情况
- **低光环境**：自动开启闪光灯提示「光线较暗，已为您开启闪光灯」
- **超过 10 页**：拍照按钮禁用，提示「最多支持 10 页，请先删除部分照片」
- **手写内容识别**：OCR 结果标记为低置信度，提示用户确认
- **非试卷内容**：AI 检测到拍摄内容非试卷，提示「这似乎不是试卷，请拍摄考试试卷」
- **横向拍摄**：自动检测方向并旋转，提示用户确认方向
- **多份试卷混拍**：提示「建议每次只拍摄一份试卷，以确保分析准确」
- **从相册选择截图**：检测到截图尺寸比例，提示「建议使用相机拍摄实体试卷，效果更好」
- **大文件上传**：自动压缩图片至合适大小（单张 < 5MB），压缩过程对用户透明
- **三科全部上传完成**：状态五不再显示剩余科目按钮，仅显示「全部上传完成，下一步」

## 导航关系

### 从哪来
- A3a 学生建档对话页（建档完成后进入试卷上传流程）
- B1 学生首页（主动上传新试卷）
- B1 学生首页（快捷入口「拍试卷」）

### 到哪去
- **入口引导「我没有试卷」** → C1 学习计划创建（无试卷数据，三科走自选学习方向）
- **入口引导「我有试卷」** → 进入状态一（拍照取景界面）
- **拍照完成 → 裁剪调整**（页面内状态切换，非跳转）
- **裁剪确认 → 试卷信息填写**（页面内状态切换）
- **开始识别 → OCR 识别结果**（页面内状态切换）
- **确认识别结果** → 状态五（多科目连续上传引导）
- **状态五选择继续上传某科目** → 回到状态一（拍照取景界面，科目自动预选）
- **状态五选择「没有了，下一步」** → C1 学习计划创建（携带已上传科目的诊断数据）
- **点击返回**：
  - 入口引导返回上一页面（A3a / B1 / D1）
  - 拍照状态返回入口引导
  - 裁剪状态返回拍照状态
  - 信息填写返回拍照状态（保留已拍照片）
  - 识别结果返回信息填写（保留填写内容）
  - 多科目引导返回识别结果
- **取消流程**：弹出确认「已拍摄的照片将不会保存，确定离开吗？」
