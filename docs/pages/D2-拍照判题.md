# D2 拍照判题

## 页面信息
- **所属模块**：D-核心学习模块
- **页面类型**：全屏页（三步流程：拍照 → 裁剪确认 → 判题结果）+ 判题记录列表页
- **数字人老师**：小/右上角悬浮（结果页显示）；内嵌答疑面板中以对话气泡形式出现
- **支持模式**：学生
- **路由**：`/photo-judge`（拍照判题）、`/photo-judge/history`（判题记录）

## 线框图

### 步骤一：拍照取景

```
┌──────────────────────────────────┐
│ ← 拍照判题        🕐  🔦  ❓    │
├──────────────────────────────────┤
│                                  │
│                                  │
│   ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐   │
│   │                         │   │
│   │                         │   │
│   │     请将试卷/作业       │   │
│   │     对准此区域          │   │
│   │                         │   │
│   │                         │   │
│   │   ┌─────────────────┐   │   │
│   │   │  自动识别题目中  │   │   │
│   │   └─────────────────┘   │   │
│   │                         │   │
│   │                         │   │
│   └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘   │
│                                  │
│                                  │
│   ┌──────┐           ┌──────┐   │
│   │ 相册 │   [📷]    │ 多页 │   │
│   └──────┘           └──────┘   │
│                                  │
└──────────────────────────────────┘
```

### 步骤二：裁剪确认

```
┌──────────────────────────────────┐
│ ← 裁剪确认                      │
├──────────────────────────────────┤
│                                  │
│  ┌──────────────────────────┐   │
│  │ ○ ──────────────── ○     │   │
│  │ │                    │   │   │
│  │ │  1. 3/4 + 1/2 =   │   │   │
│  │ │  2. 5 × 3 - 7 =   │   │   │
│  │ │  3. 12 ÷ 4 + 2 =  │   │   │
│  │ │  4. 8 - 3/5 =     │   │   │
│  │ │                    │   │   │
│  │ ○ ──────────────── ○     │   │
│  └──────────────────────────┘   │
│                                  │
│  识别到 4 道题目                 │
│                                  │
│  ┌────┐  ┌────┐  ┌──────────┐  │
│  │旋转│  │重拍│  │ 开始判题 │  │
│  └────┘  └────┘  └──────────┘  │
│                                  │
└──────────────────────────────────┘
```

### 步骤三：判题结果

```
┌──────────────────────────────────┐
│ ← 判题结果     分享  ┌────┐    │
│                       │ 🌸 │    │
│  正确 3/4  正确率 75% │老师│    │
│                       └────┘    │
├──────────────────────────────────┤
│                                  │
│  ✅ 1. 3/4 + 1/2 = 5/4         │
│     你的答案：5/4  ✓ 正确       │
│  ──────────────────────────────  │
│                                  │
│  ✅ 2. 5 × 3 - 7 = 8           │
│     你的答案：8    ✓ 正确       │
│  ──────────────────────────────  │
│                                  │
│  ❌ 3. 12 ÷ 4 + 2 = 5          │
│     你的答案：4    ✗ 错误       │
│  ┌──────────────────────────┐   │
│  │ 📖 展开详细解析    ▼     │   │
│  │ ☐ 加入错题本              │   │
│  └──────────────────────────┘   │
│  ──────────────────────────────  │
│                                  │
│  ✅ 4. 8 - 3/5 = 37/5          │
│     你的答案：37/5 ✓ 正确       │
│  ──────────────────────────────  │
│                                  │
│  ┌──────────────────────────┐   │
│  │  📝 问小花老师这道题     │   │
│  └──────────────────────────┘   │
│                                  │
└──────────────────────────────────┘
```

### 错题展开详细解析

```
┌──────────────────────────────────┐
│  ❌ 3. 12 ÷ 4 + 2 = 5          │
│     你的答案：4    ✗ 错误       │
│  ┌──────────────────────────┐   │
│  │ 📖 收起详细解析    ▲     │   │
│  │                          │   │
│  │ 解题步骤：               │   │
│  │ ① 先算除法：12÷4 = 3    │   │
│  │ ② 再算加法：3+2 = 5     │   │
│  │                          │   │
│  │ 知识点：四则运算优先级   │   │
│  │ ┌────────────────────┐   │   │
│  │ │ 查看知识点精讲 →   │   │   │
│  │ └────────────────────┘   │   │
│  │                          │   │
│  │ ☑ 已加入错题本           │   │
│  └──────────────────────────┘   │
└──────────────────────────────────┘
```

### 结果页 - 内嵌答疑面板（点击"问小花老师这道题"弹出）

```
┌──────────────────────────────────┐
│ ← 判题结果     分享  ┌────┐    │
│                       │ 🌸 │    │
│  （判题结果内容，      └────┘    │
│   半透明遮罩覆盖）              │
│                                  │
│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│
│┌────────────────────────────────┐│
││ 🌸 小花老师              ✕    ││
││     在线答疑中                  ││
│├────────────────────────────────┤│
││                                ││
││ ┌─────────────────────┐       ││
││ │ 🌸 这几道题有什么不  │       ││
││ │ 明白的吗？告诉我，   │       ││
││ │ 我来帮你讲解～        │       ││
││ └─────────────────────┘       ││
││                                ││
││       ┌─────────────────────┐ ││
││       │ 第3题为什么是5？    │ ││
││       └─────────────────────┘ ││
││                                ││
││ ┌─────────────────────┐       ││
││ │ 🌸 第3题 12÷4+2，   │       ││
││ │ 先算除法12÷4=3，     │       ││
││ │ 再算加法3+2=5...     │       ││
││ └─────────────────────┘       ││
││                                ││
│├────────────────────────────────┤│
││ 🎤 ┌────────────────┐  ➤  ⊕  ││
││    │ 输入你的问题...  │        ││
││    └────────────────┘         ││
│└────────────────────────────────┘│
└──────────────────────────────────┘
```

### D2-b 判题记录页（`/photo-judge/history`）

```
┌──────────────────────────────────┐
│ ← 判题记录                      │
├──────────────────────────────────┤
│                                  │
│ ┌────────────────────────────┐  │
│ │ ┌───┐                     │  │
│ │ │75%│ 数学                 │  │
│ │ │ ○ │ 2026-02-26 15:20    │  │
│ │ └───┘ 3/4 正确  查看详情 >│  │
│ │ 错题：[第3题]              │  │
│ └────────────────────────────┘  │
│                                  │
│ ┌────────────────────────────┐  │
│ │ ┌────┐                    │  │
│ │ │100%│ 数学                │  │
│ │ │ ○  │ 2026-02-25 19:45   │  │
│ │ └────┘ 3/3 正确  查看详情 >│  │
│ └────────────────────────────┘  │
│                                  │
│ ┌────────────────────────────┐  │
│ │ ┌───┐                     │  │
│ │ │60%│ 数学                 │  │
│ │ │ ○ │ 2026-02-24 20:10    │  │
│ │ └───┘ 3/5 正确  查看详情 >│  │
│ │ 错题：[第2题] [第5题]      │  │
│ └────────────────────────────┘  │
│                                  │
│       ... 更多记录 ...           │
│                                  │
└──────────────────────────────────┘
```

### 判题记录 - 左滑删除

```
┌──────────────────────────────────┐
│ ┌──────────────────────┬──────┐ │
│ │ 75% 数学             │      │ │
│ │ 2026-02-26 15:20     │ 删除 │ │
│ │ 3/4 正确             │      │ │
│ └──────────────────────┴──────┘ │
└──────────────────────────────────┘
```

### 判题记录 - 查看详情弹窗

```
┌──────────────────────────────────┐
│  （半透明遮罩覆盖列表）          │
│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│
│┌────────────────────────────────┐│
││ 数学 · 2026-02-26 15:20  ✕   ││
││ 4 题 · 正确率 75%              ││
│├────────────────────────────────┤│
││                                ││
││ ✅ 1. 3/4 + 1/2 = 5/4        ││
││    你的答案：5/4  ✓ 正确      ││
││                                ││
││ ✅ 2. 5 × 3 - 7 = 8          ││
││    你的答案：8    ✓ 正确      ││
││                                ││
││ ❌ 3. 12 ÷ 4 + 2 = 5         ││
││    你的答案：4    ✗ 错误      ││
││    📖 查看解析  ▼              ││
││                                ││
││ ✅ 4. 8 - 3/5 = 37/5         ││
││    你的答案：37/5 ✓ 正确      ││
││                                ││
│└────────────────────────────────┘│
└──────────────────────────────────┘
```

### 判题记录 - 空状态

```
┌──────────────────────────────────┐
│ ← 判题记录                      │
├──────────────────────────────────┤
│                                  │
│                                  │
│           ┌──────┐              │
│           │  📋  │              │
│           └──────┘              │
│        暂无判题记录              │
│                                  │
│      ┌──────────────┐           │
│      │  去拍照判题   │           │
│      └──────────────┘           │
│                                  │
└──────────────────────────────────┘
```

## 元素说明

| 元素 | 类型 | 说明 |
|------|------|------|
| 取景框 | 相机覆盖层 | 虚线矩形引导框，可自动检测纸张边缘并高亮提示 |
| 自动识别提示 | 文本标签 | 实时显示识别状态："自动识别题目中" / "已识别到N道题" |
| 拍照按钮 | 圆形按钮 | 底部居中大圆按钮，按下有缩放反馈 |
| 相册入口 | 按钮 | 左下角，支持从相册选择已有照片 |
| 多页模式 | 按钮 | 右下角，支持连续拍摄多页后一起判题 |
| 闪光灯开关 | 图标按钮 | 顶部右侧，切换闪光灯开/关/自动 |
| 裁剪框 | 可拖拽控件 | 四角可拖拽调整裁剪范围，带网格辅助线 |
| 旋转按钮 | 按钮 | 每次点击顺时针旋转90度 |
| 判题结果卡片 | 列表项 | 绿色标记正确题、红色标记错误题 |
| 展开解析按钮 | 可折叠区域 | 错误题目下方，点击展开详细解题步骤 |
| 错题本开关 | Switch控件 | 每道错题旁，开启后自动加入错题本 |
| 知识点链接 | 文本链接 | 蓝色可点击文本，跳转到相关知识点精讲 |
| 问老师按钮 | 主操作按钮 | 底部固定按钮，点击弹出内嵌答疑面板与小花老师互动 |
| 小花老师头像 | 悬浮视图 | 结果页右上角，48x48圆形头像 |
| 判题记录入口 | 图标按钮 | 拍照页顶部右侧时钟图标，跳转到判题记录列表页 |
| 内嵌答疑面板 | 底部滑出面板 | 占屏幕60%高度，圆角顶部，含小花老师头像+名称+关闭按钮+消息列表+输入栏 |
| 答疑消息气泡 | 聊天气泡 | 复用 DialogBubble 组件，AI消息左对齐，用户消息右对齐 |
| 答疑输入栏 | 输入控件 | 复用 ChatInputBar 组件，支持文字/语音切换输入 |
| 记录卡片 | 列表卡片 | 环形正确率图+学科+日期+正确题数+错题标签，可点击查看详情 |
| 左滑删除 | 滑动操作 | 卡片左滑露出红色"删除"按钮 |
| 删除确认弹窗 | 模态弹窗 | 居中弹窗，提示"删除后无法恢复"，取消/删除双按钮 |
| 详情弹窗 | 底部滑出面板 | 占屏幕75%高度，展示该次判题所有题目及解析 |

## 交互行为

### 手势交互
- **双指缩放（结果页）**：在判题结果页支持双指捏合缩放，查看原图标注细节
- **上下滚动（结果页）**：纵向滚动查看所有题目结果
- **左右滑动（多页模式）**：多页拍摄时左右切换不同页面的结果
- **拖拽裁剪角**：裁剪确认页四个角可自由拖拽调整识别区域

### 输入交互
- **点击拍照按钮**：拍照并自动跳转到裁剪确认页
- **点击相册**：打开系统相册选择图片
- **点击"开始判题"**：提交图片进行AI识别和判题
- **点击"展开详细解析"**：折叠面板展开，显示解题步骤和知识点
- **切换"加入错题本"**：开启/关闭该题的错题本收录
- **点击"查看知识点精讲"**：跳转到D4知识点精讲页面
- **点击"问小花老师这道题"**：从底部弹出内嵌答疑面板，小花老师开场白"这几道题有什么不明白的吗？告诉我，我来帮你讲解～"
- **答疑面板发送消息**：输入文字或语音后发送，小花老师根据关键词（如"第3题"）返回对应题目的解析回复
- **关闭答疑面板**：点击关闭按钮或点击半透明遮罩收起面板
- **点击小花老师头像**：触发小花老师语音讲解当前判题总结
- **点击判题记录入口**：拍照页顶部时钟图标，跳转到 `/photo-judge/history` 判题记录列表
- **查看判题记录详情**：点击记录卡片，从底部弹出详情面板，展示所有题目和解析
- **左滑删除记录**：卡片左滑超过60px露出删除按钮，点击弹出确认弹窗后删除
- **空状态跳转**：无记录时显示空状态，点击"去拍照判题"跳转到 `/photo-judge`

### 动画与反馈
- **拍照快门动画**：按下拍照按钮时屏幕短暂白闪模拟快门效果
- **识别进度动画**：裁剪确认后显示扫描线从上到下滑动动画，表示正在识别
- **判题加载**：结果页题目逐个从上往下渐入，正确题绿色闪一下，错误题红色闪一下
- **错题本切换动画**：开关切换时有弹性动画 + 轻微震动反馈
- **展开/收起解析**：平滑的高度过渡动画，300ms缓动
- **纸张边缘检测**：取景时实时检测到纸张边缘，引导框变为绿色实线

### AI 老师交互
- **拍照页进入**：小花老师语音提示"把作业放平，对准框框拍一张吧~"
- **识别完成**：小花老师语音"识别到X道题，帮你检查一下！"
- **全对**：小花老师语音"哇，全对了！你太厉害了！" + 撒花动画
- **有错题**：小花老师语音"有X道题需要再看看哦，点开看看解析吧"
- **点击问老师**：跳转D3答疑页，小花老师语音"这道题哪里不明白？告诉我吧"

## 状态枚举

### 默认状态
- 步骤一：相机预览正常显示，取景引导框虚线闪烁
- 步骤二：裁剪框自动贴合检测到的纸张边缘
- 步骤三：判题结果正常展示，错题默认收起解析

### 空状态
- 场景：拍摄的图片中未识别到任何题目
- 展示：提示图 + "没有识别到题目哦，请确保拍照清晰、题目完整"
- 操作："重新拍照"按钮

### 加载状态
- 裁剪确认 → 结果：显示全屏加载动画，扫描线反复扫描 + "正在识别中，请稍候…"
- 预计耗时提示：超过3秒显示"题目较多，需要多一点时间~"

### 错误状态
- **相机权限未授权**：显示相机权限引导页 + "去设置"按钮
- **图片模糊**：裁剪确认页提示"图片可能模糊，建议重拍" + "仍然判题" / "重新拍照"
- **识别失败**：服务端识别异常，显示"识别出了点问题" + "重试" / "换张照片"
- **网络异常**：断网提示 + "重试"按钮

### 边界情况
- **题目数量上限**：单张图片最多支持识别20道题，超出部分提示"建议分多次拍摄"
- **混合学科**：识别到多学科题目时，按学科分组显示，顶部增加学科筛选
- **手写识别**：对手写答案识别不确定时，标注"答案识别可能不准确，请确认"并支持手动修改
- **多页合并**：多页模式下最多支持5页连拍，结果统一展示并标注页码
- **重复拍摄**：同一道题重复拍摄判题时，自动关联并显示历史记录

## 导航关系

### 从哪来
- **B1-首页**：点击今日学习计划中类型为"拍照判题"的任务卡片
- **B1-首页**：点击首页"拍照判题"快捷入口（路由 `/photo-judge`）

### 到哪去
- **D2-b 判题记录**：拍照页顶部时钟图标 → `/photo-judge/history`
- **D3-实时答疑**：结果页内嵌答疑面板直接与小花老师互动（无需跳转）
- **D4-知识点精讲**：点击错题解析中的"查看知识点精讲"链接
