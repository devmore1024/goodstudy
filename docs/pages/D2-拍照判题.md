# D2 拍照判题

## 页面信息
- **所属模块**：D-核心学习模块
- **页面类型**：全屏页（三步流程：拍照 → 裁剪确认 → 判题结果）
- **数字人老师**：小/右上角悬浮（结果页显示）
- **支持模式**：学生

## 线框图

### 步骤一：拍照取景

```
┌──────────────────────────────────┐
│ ← 拍照判题            🔦  ❓    │
├──────────────────────────────────┤
│                                  │
│                                  │
│   ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐   │
│   │                         │   │
│   │                         │   │
│   │     请将试卷/作业       │   │
│   │     对准此区域          │   │
│   │                         │   │
│   │                         │   │
│   │   ┌─────────────────┐   │   │
│   │   │  自动识别题目中  │   │   │
│   │   └─────────────────┘   │   │
│   │                         │   │
│   │                         │   │
│   └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘   │
│                                  │
│                                  │
│   ┌──────┐           ┌──────┐   │
│   │ 相册 │   [📷]    │ 多页 │   │
│   └──────┘           └──────┘   │
│                                  │
└──────────────────────────────────┘
```

### 步骤二：裁剪确认

```
┌──────────────────────────────────┐
│ ← 裁剪确认                      │
├──────────────────────────────────┤
│                                  │
│  ┌──────────────────────────┐   │
│  │ ○ ──────────────── ○     │   │
│  │ │                    │   │   │
│  │ │  1. 3/4 + 1/2 =   │   │   │
│  │ │  2. 5 × 3 - 7 =   │   │   │
│  │ │  3. 12 ÷ 4 + 2 =  │   │   │
│  │ │  4. 8 - 3/5 =     │   │   │
│  │ │                    │   │   │
│  │ ○ ──────────────── ○     │   │
│  └──────────────────────────┘   │
│                                  │
│  识别到 4 道题目                 │
│                                  │
│  ┌────┐  ┌────┐  ┌──────────┐  │
│  │旋转│  │重拍│  │ 开始判题 │  │
│  └────┘  └────┘  └──────────┘  │
│                                  │
└──────────────────────────────────┘
```

### 步骤三：判题结果

```
┌──────────────────────────────────┐
│ ← 判题结果     分享  ┌────┐    │
│                       │ 🌸 │    │
│  正确 3/4  正确率 75% │老师│    │
│                       └────┘    │
├──────────────────────────────────┤
│                                  │
│  ✅ 1. 3/4 + 1/2 = 5/4         │
│     你的答案：5/4  ✓ 正确       │
│  ──────────────────────────────  │
│                                  │
│  ✅ 2. 5 × 3 - 7 = 8           │
│     你的答案：8    ✓ 正确       │
│  ──────────────────────────────  │
│                                  │
│  ❌ 3. 12 ÷ 4 + 2 = 5          │
│     你的答案：4    ✗ 错误       │
│  ┌──────────────────────────┐   │
│  │ 📖 展开详细解析    ▼     │   │
│  │ ☐ 加入错题本              │   │
│  └──────────────────────────┘   │
│  ──────────────────────────────  │
│                                  │
│  ✅ 4. 8 - 3/5 = 37/5          │
│     你的答案：37/5 ✓ 正确       │
│  ──────────────────────────────  │
│                                  │
│  ┌──────────────────────────┐   │
│  │  📝 问小花老师这道题     │   │
│  └──────────────────────────┘   │
│                                  │
└──────────────────────────────────┘
```

### 错题展开详细解析

```
┌──────────────────────────────────┐
│  ❌ 3. 12 ÷ 4 + 2 = 5          │
│     你的答案：4    ✗ 错误       │
│  ┌──────────────────────────┐   │
│  │ 📖 收起详细解析    ▲     │   │
│  │                          │   │
│  │ 解题步骤：               │   │
│  │ ① 先算除法：12÷4 = 3    │   │
│  │ ② 再算加法：3+2 = 5     │   │
│  │                          │   │
│  │ 知识点：四则运算优先级   │   │
│  │ ┌────────────────────┐   │   │
│  │ │ 查看知识点精讲 →   │   │   │
│  │ └────────────────────┘   │   │
│  │                          │   │
│  │ ☑ 已加入错题本           │   │
│  └──────────────────────────┘   │
└──────────────────────────────────┘
```

## 元素说明

| 元素 | 类型 | 说明 |
|------|------|------|
| 取景框 | 相机覆盖层 | 虚线矩形引导框，可自动检测纸张边缘并高亮提示 |
| 自动识别提示 | 文本标签 | 实时显示识别状态："自动识别题目中" / "已识别到N道题" |
| 拍照按钮 | 圆形按钮 | 底部居中大圆按钮，按下有缩放反馈 |
| 相册入口 | 按钮 | 左下角，支持从相册选择已有照片 |
| 多页模式 | 按钮 | 右下角，支持连续拍摄多页后一起判题 |
| 闪光灯开关 | 图标按钮 | 顶部右侧，切换闪光灯开/关/自动 |
| 裁剪框 | 可拖拽控件 | 四角可拖拽调整裁剪范围，带网格辅助线 |
| 旋转按钮 | 按钮 | 每次点击顺时针旋转90度 |
| 判题结果卡片 | 列表项 | 绿色标记正确题、红色标记错误题 |
| 展开解析按钮 | 可折叠区域 | 错误题目下方，点击展开详细解题步骤 |
| 错题本开关 | Switch控件 | 每道错题旁，开启后自动加入错题本 |
| 知识点链接 | 文本链接 | 蓝色可点击文本，跳转到相关知识点精讲 |
| 问老师按钮 | 主操作按钮 | 底部固定按钮，针对某道题向小花老师提问 |
| 小花老师头像 | 悬浮视图 | 结果页右上角，48x48圆形头像 |

## 交互行为

### 手势交互
- **双指缩放（结果页）**：在判题结果页支持双指捏合缩放，查看原图标注细节
- **上下滚动（结果页）**：纵向滚动查看所有题目结果
- **左右滑动（多页模式）**：多页拍摄时左右切换不同页面的结果
- **拖拽裁剪角**：裁剪确认页四个角可自由拖拽调整识别区域

### 输入交互
- **点击拍照按钮**：拍照并自动跳转到裁剪确认页
- **点击相册**：打开系统相册选择图片
- **点击"开始判题"**：提交图片进行AI识别和判题
- **点击"展开详细解析"**：折叠面板展开，显示解题步骤和知识点
- **切换"加入错题本"**：开启/关闭该题的错题本收录
- **点击"查看知识点精讲"**：跳转到D4知识点精讲页面
- **点击"问小花老师这道题"**：携带题目信息跳转到D3实时答疑
- **点击小花老师头像**：触发小花老师语音讲解当前判题总结

### 动画与反馈
- **拍照快门动画**：按下拍照按钮时屏幕短暂白闪模拟快门效果
- **识别进度动画**：裁剪确认后显示扫描线从上到下滑动动画，表示正在识别
- **判题加载**：结果页题目逐个从上往下渐入，正确题绿色闪一下，错误题红色闪一下
- **错题本切换动画**：开关切换时有弹性动画 + 轻微震动反馈
- **展开/收起解析**：平滑的高度过渡动画，300ms缓动
- **纸张边缘检测**：取景时实时检测到纸张边缘，引导框变为绿色实线

### AI 老师交互
- **拍照页进入**：小花老师语音提示"把作业放平，对准框框拍一张吧~"
- **识别完成**：小花老师语音"识别到X道题，帮你检查一下！"
- **全对**：小花老师语音"哇，全对了！你太厉害了！" + 撒花动画
- **有错题**：小花老师语音"有X道题需要再看看哦，点开看看解析吧"
- **点击问老师**：跳转D3答疑页，小花老师语音"这道题哪里不明白？告诉我吧"

## 状态枚举

### 默认状态
- 步骤一：相机预览正常显示，取景引导框虚线闪烁
- 步骤二：裁剪框自动贴合检测到的纸张边缘
- 步骤三：判题结果正常展示，错题默认收起解析

### 空状态
- 场景：拍摄的图片中未识别到任何题目
- 展示：提示图 + "没有识别到题目哦，请确保拍照清晰、题目完整"
- 操作："重新拍照"按钮

### 加载状态
- 裁剪确认 → 结果：显示全屏加载动画，扫描线反复扫描 + "正在识别中，请稍候…"
- 预计耗时提示：超过3秒显示"题目较多，需要多一点时间~"

### 错误状态
- **相机权限未授权**：显示相机权限引导页 + "去设置"按钮
- **图片模糊**：裁剪确认页提示"图片可能模糊，建议重拍" + "仍然判题" / "重新拍照"
- **识别失败**：服务端识别异常，显示"识别出了点问题" + "重试" / "换张照片"
- **网络异常**：断网提示 + "重试"按钮

### 边界情况
- **题目数量上限**：单张图片最多支持识别20道题，超出部分提示"建议分多次拍摄"
- **混合学科**：识别到多学科题目时，按学科分组显示，顶部增加学科筛选
- **手写识别**：对手写答案识别不确定时，标注"答案识别可能不准确，请确认"并支持手动修改
- **多页合并**：多页模式下最多支持5页连拍，结果统一展示并标注页码
- **重复拍摄**：同一道题重复拍摄判题时，自动关联并显示历史记录

## 导航关系

### 从哪来
- **D1-每日学习主页**：点击类型为"拍照判题"的任务卡片
- **B1-首页**：点击首页"拍照判题"快捷入口

### 到哪去
- **D3-实时答疑**：点击"问小花老师这道题"按钮，携带题目信息进入答疑
- **D4-知识点精讲**：点击错题解析中的"查看知识点精讲"链接
