# A3 AI老师欢迎对话

## 页面信息
- **所属模块**：登录注册模块
- **页面类型**：全屏页
- **数字人老师**：大/居中
- **支持模式**：通用

## 线框图

```
+----------------------------------------+
|  9:41            ⚡ 📶 100%            |
|                                        |
|                                        |
|                                        |
|           +----------------+           |
|           |                |           |
|           |                |           |
|           |    数字人老师   |           |
|           |    全身形象     |           |
|           |    (动态)      |           |
|           |                |           |
|           |   200 x 280pt  |           |
|           |                |           |
|           +----------------+           |
|                                        |
|    +----------------------------------+|
|    |  "你好呀！我是小花老师~"         ||
|    +----------------------------------+|
|                                        |
|    +----------------------------------+|
|    |  ◉ 声纹采集进度 ████░░░░ 40%     ||
|    +----------------------------------+|
|                                        |
|          +--------------------+        |
|          |  🎤 按住说话       |        |
|          +--------------------+        |
|                                        |
|      ~~~ 语音波形动画区域 ~~~          |
|                                        |
+----------------------------------------+
```

## 元素说明

### 1. 状态栏与导航栏
- **位置**：页面顶部
- **样式**：透明背景，融入页面
- **左侧**：返回按钮（箭头图标），点击返回 A2 登录页
- **右侧**：「跳过」文字按钮，字号 14pt，颜色 #999999

### 2. 数字人老师形象
- **位置**：页面上半部分居中，距顶部安全区域 60pt
- **尺寸**：200 × 280 pt
- **内容**：小花老师全身卡通形象，站立姿态
- **样式**：半透明渐变底座，角色本身为高清插画风格
- **动画**：
  - 待机状态：轻微呼吸动画（上下浮动 2pt，周期 3s）+ 眨眼动画（随机间隔 3-5s）
  - 说话状态：嘴型动画与语音同步，手部有挥动/指引动作
  - 聆听状态：身体微微前倾，手放耳边做聆听姿态
  - 思考状态：手托下巴，眼睛看向上方

### 3. 对话气泡
- **位置**：数字人老师形象下方 16pt
- **尺寸**：左右边距 24pt，高度自适应
- **样式**：白色背景，圆角 16pt，投影 0 2px 8px rgba(0,0,0,0.08)，顶部有三角箭头指向数字人
- **内容**：AI 老师说话文字，字号 16pt，颜色 #333333，行高 1.5
- **动画**：文字逐字出现，与语音同步，速度约 6 字/秒
- **交互**：点击气泡可暂停/继续语音播放

### 4. 声纹采集进度条
- **位置**：对话气泡下方 16pt，左右边距 24pt
- **尺寸**：高 40pt，宽度充满
- **结构**：
  - 左侧图标：话筒图标，品牌色
  - 文字标签：「声纹采集进度」，字号 13pt，颜色 #666666
  - 进度条：高 4pt，圆角 2pt，背景 #F0F0F0，填充渐变品牌色
  - 百分比文字：字号 13pt，品牌色
- **说明**：声纹采集贯穿整个对话过程，用户说话时自动采集
- **显示条件**：当前用户尚未完成声纹采集时显示，已完成时隐藏

### 5. 语音输入按钮
- **位置**：声纹采集进度条下方 20pt，水平居中
- **尺寸**：宽 200pt，高 48pt
- **默认样式**：品牌色渐变背景，圆角 24pt，白色话筒图标 + 文字「按住说话」
- **按住样式**：背景变深，圆形扩展为全屏半透明遮罩，中心显示大型话筒图标
- **松手样式**：恢复默认，显示处理中动画

### 6. 语音波形动画区域
- **位置**：语音按钮下方 12pt，水平居中
- **尺寸**：宽 200pt，高 32pt
- **内容**：音频波形可视化
- **样式**：品牌色渐变波形线条，5-7 根垂直线条高度随声音振幅变化
- **显示条件**：仅在用户说话时显示，其他时候隐藏或显示静止状态

### 7. 背景
- **样式**：浅色渐变背景，从顶部 #FFF8F0（暖黄）到底部 #FFFFFF（白色）
- **装饰**：底部有轻微的几何装饰图案，不影响内容阅读

## 交互行为

### 手势交互
- **按住说话**：长按语音按钮开始录音，松手结束
- **上滑取消**：按住语音按钮后上滑超过 80pt 取消当前语音输入
- **点击气泡**：暂停/继续 AI 老师语音播放
- **左滑返回**：返回 A2 登录页（需二次确认「确定要离开吗？」）

### 输入交互
- **语音输入**：长按语音按钮录音，松手后自动识别
- **键盘输入**：底部可切换为文字输入模式（小型键盘图标），弹出文字输入框
- **语音识别**：实时显示识别中的文字（流式）

### 动画与反馈
- **页面进入**：数字人老师从底部滑入 + 缩放出现，时长 500ms
- **AI 开始说话**：对话气泡从小到大弹出（spring 动画），文字逐字出现
- **用户按住说话**：
  - 语音按钮放大至 1.2 倍
  - 波形动画开始
  - 数字人做出聆听姿态
  - 轻微震动反馈
- **用户松手**：
  - 波形动画停止
  - 按钮恢复原大小
  - 显示「识别中...」过渡动画
- **身份确认反馈**：AI 确认身份后，对话气泡高亮显示确认结果
- **声纹采集进度更新**：进度条平滑增长动画

### AI 老师交互

#### 语音识别状态机
```
空闲(idle) → [用户按下] → 聆听(listening) → [用户松手] → 处理(processing) → 回应(responding) → 空闲(idle)
```

- **空闲态**：数字人待机动画，语音按钮显示「按住说话」
- **聆听态**：数字人聆听姿态，波形动画，语音按钮显示「松手结束」
- **处理态**：数字人思考姿态，气泡显示「...」打字指示器
- **回应态**：数字人说话动画，气泡显示回复文字，语音同步播放

#### 对话流程

##### 首次登录
1. **AI 主动打招呼**：「你好呀！我是小花老师~」
   - 数字人挥手动画
   - 等待 1.5 秒后自动进入下一步

2. **AI 询问身份**：「请问你是小朋友呢，还是爸爸妈妈呀？」
   - 纯对话方式，不显示任何按钮
   - 用户通过语音或文字自由回答

3. **AI 判断身份**：根据用户回答内容判断身份
   - 识别关键词：「小朋友」「学生」「小孩」「我上X年级」等 → 判定为学生
   - 识别关键词：「爸爸」「妈妈」「家长」「父母」「爷爷」「奶奶」等 → 判定为家长
   - 无法判断时追问：「没关系，你可以告诉我，你是正在上学的小朋友，还是小朋友的爸爸妈妈呀？」

4. **AI 确认身份**：
   - 判定为学生 → 「你是小朋友对吧？」
   - 判定为家长 → 「您是家长对吧？」
   - 等待用户确认

5. **用户确认/纠正**：
   - 用户确认（「对」「是的」「嗯」等）→ AI 回应后跳转对应流程
     - 学生：「太好啦！那让我来了解一下你吧~」→ 跳转 A3a
     - 家长：「欢迎家长！让我来帮您管理孩子的学习吧~」→ 跳转 A3b
   - 用户否认（「不对」「不是」「选错了」等）→ AI 回应「哦！那请问你是小朋友还是家长呢？」→ 回到第 2 步重新判断

##### 非首次登录（已建档用户再次进入）
- 通过声纹或账号信息识别用户身份
- **识别为已建档学生**：
  - AI 打招呼：「[姓名]同学，欢迎回来！准备好继续学习了吗？」
  - 等待 2 秒后自动跳转 B1 学生首页
  - 在等待期间，用户可主动说话打断跳转（如查看/修改档案）
- **识别为已建档家长**：
  - AI 打招呼：「[称呼]您好，欢迎回来~」
  - 等待 2 秒后自动跳转 B2 家长首页
  - 在等待期间，用户可主动说话打断跳转（如查看/修改档案）
- **无法识别（如新设备登录、声纹未匹配）**：
  - AI 打招呼：「你好呀！我是小花老师~」
  - 若账号下已有建档信息，AI 询问：「请问你是[姓名]同学，还是[姓名]的家长呢？」
  - 用户确认后跳转对应首页
  - 若为新用户，进入首次登录的身份判断流程

##### 档案查看与修改（非首次登录时可触发）
- 用户在 A3 欢迎对话中可随时通过语音/文字请求查看或修改档案
- **触发方式**：用户说「我想看看我的档案」「帮我改一下信息」「修改年级」「查看档案」等
- **查看档案**：
  - AI 回应：「好的，这是你的档案信息~」
  - 在对话气泡中嵌入档案信息卡片（样式同 A3a/A3b 的档案确认卡片）
  - 学生档案：姓名、年级、城市、声纹状态
  - 家长档案：身份（称呼）、声纹状态、关联孩子列表
  - 卡片底部显示：「我要修改」/「没问题」按钮
- **修改档案**：
  - 用户点击「我要修改」或直接说出要修改的内容（如「我升到四年级了」「我搬到上海了」）
  - AI 回应：「没问题，你想修改哪一项呢？」（若用户未指明具体字段）
  - AI 直接确认：「好的，帮你把年级改成四年级了~」（若用户已说明具体修改）
  - 展开对应选择器供用户重新选择
  - 修改完成后重新展示档案确认卡片，用户确认后保存
  - AI 提示：「档案已更新好了~」→ 继续跳转对应首页

#### 身份纠错机制
- **A3 对话中纠错**：在确认身份之前，用户随时可以说出正确身份，AI 重新判断
- **A3a/A3b 中纠错**：
  - 在 A3a/A3b 对话过程中，用户说「我其实是家长」/「我其实是学生」，AI 识别后询问「您想切换到家长/学生模式吗？」
  - 用户确认后返回 A3，以新身份重新进入对应建档流程
- **导航返回纠错**：在 A3a/A3b 顶部导航点击「返回」可回到 A3 重新进行身份判断

#### 声纹采集逻辑
- 在整个对话过程中，后台持续采集用户语音特征
- 需要累计约 10 秒有效语音数据完成声纹建模
- 进度条实时反映采集进度
- 采集完成后进度条变为「声纹采集完成 ✓」并 2 秒后淡出
- 若对话结束时声纹未采集完成，在后续页面继续采集

#### 麦克风权限引导
- 首次进入时若麦克风权限未授权，在 AI 说话完毕后弹出系统权限请求
- 若用户拒绝权限：
  - 语音按钮变为不可用状态
  - 显示文字输入框替代
  - 底部提示「开启麦克风权限可使用语音对话」+ 「去设置」按钮
  - 声纹采集进度条隐藏，后续通过其他方式补采

## 状态枚举

### 默认状态
- 数字人老师居中展示，播放打招呼动画和语音
- 对话气泡显示欢迎文字
- 声纹采集进度 0%
- 语音按钮可用

### 空状态
- 不适用（非列表页面）

### 加载状态
- **AI 回复加载中**：对话气泡显示三个跳动的点（typing indicator），数字人做思考动画
- **语音识别中**：语音按钮显示旋转加载图标
- **声纹模型建立中**：声纹进度 100% 后显示「正在建立声纹模型...」

### 错误状态
- **语音识别失败**：气泡提示「没有听清楚，请再说一遍~」，语音按钮恢复可用
- **AI 回复超时**：提示「小花老师正在思考，请稍等...」，5 秒后仍无响应显示「重试」按钮
- **网络断开**：顶部下拉显示红色横幅「网络已断开」，语音功能不可用，显示离线提示
- **麦克风硬件异常**：提示「麦克风不可用」，自动切换为文字输入模式

### 边界情况
- **用户长时间无操作**：30 秒无操作后 AI 主动引导「你在吗？可以告诉我你是小朋友还是爸爸妈妈哦~」
- **用户语音过短（< 1秒）**：提示「说话时间太短了，请长按按钮再试一次~」
- **用户语音过长（> 30秒）**：自动截断，取前 30 秒内容
- **环境噪音过大**：提示「周围有点吵，可以换个安静的地方或使用文字输入」
- **AI 多次无法判断身份**：连续 3 次无法判断后，AI 提示「没关系，请直接告诉我"学生"或"家长"就好~」
- **快速跳过**：点击「跳过」按钮，弹出确认弹窗「跳过后将以默认身份进入，是否继续？」

## 导航关系

### 从哪来
- A2 手机号登录页（首次注册成功后自动跳转）

### 到哪去
- **确认学生身份** → A3a 学生建档对话页
- **确认家长身份** → A3b 家长建档对话页
- **点击返回** → A2 手机号登录页（需确认）
- **点击跳过** → B1 学生首页（默认身份，后续补充档案）
