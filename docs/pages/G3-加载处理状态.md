# G3 加载处理状态

## 页面信息
- **所属模块**：全局组件（G 系列）
- **页面类型**：浮层 / 页面内嵌状态
- **数字人老师**：小/右上角悬浮（部分场景在加载区域内居中显示）
- **支持模式**：通用（学生模式与家长模式均可触发）

## 线框图

### 场景一：AI 思考加载（如 AI 回答问题）

```
┌──────────────────────────────────┐
│ ◀ 返回        AI 解答       ...  │
│──────────────────────────────────│
│                                  │
│  ┌──────────────────────────┐    │
│  │  你的问题：              │    │
│  │  "这道方程怎么解？"      │    │
│  └──────────────────────────┘    │
│                                  │
│         ┌──────────┐             │
│         │ 小花老师  │             │
│         │  (思考)   │             │
│         └──────────┘             │
│                                  │
│        ╭──────────────╮          │
│        │  🧠           │          │
│        │  大脑齿轮动画  │          │
│        │  转动中...    │          │
│        ╰──────────────╯          │
│                                  │
│     小花老师正在思考中...         │
│                                  │
│    ┌────────────────────┐        │
│    │ ░░░░░░░░░░░░░░░░░░ │        │
│    │   趣味知识加载中    │        │
│    │  "你知道吗？圆周率  │        │
│    │   的前6位是..."    │        │
│    └────────────────────┘        │
│                                  │
└──────────────────────────────────┘
```

### 场景二：OCR 拍照扫描

```
┌──────────────────────────────────┐
│ ◀ 返回       题目识别       ...  │
│──────────────────────────────────│
│                                  │
│  ┌──────────────────────────┐    │
│  │                          │    │
│  │  ┌────────────────────┐  │    │
│  │  │                    │  │    │
│  │  │   题目照片预览      │  │    │
│  │  │                    │  │    │
│  │  │  ─ ─ ─ ─ ─ ─ ─ ─  │  │    │
│  │  │  ↕ 扫描线动画      │  │    │
│  │  │  ─ ─ ─ ─ ─ ─ ─ ─  │  │    │
│  │  │                    │  │    │
│  │  └────────────────────┘  │    │
│  │                          │    │
│  └──────────────────────────┘    │
│                                  │
│      正在识别题目内容...          │
│      ━━━━━━━━━━━━░░░░  65%       │
│                                  │
│                     ┌────────┐   │
│                     │小花老师 │   │
│                     │ (专注) │   │
│                     └────────┘   │
│                                  │
└──────────────────────────────────┘
```

### 场景三：生成练习题

```
┌──────────────────────────────────┐
│ ◀ 返回       生成练习       ...  │
│──────────────────────────────────│
│                                  │
│                                  │
│         ┌──────────┐             │
│         │ 小花老师  │             │
│         │  (书写)   │             │
│         └──────────┘             │
│                                  │
│        ╭──────────────╮          │
│        │               │          │
│        │   ✏️ 铅笔动画  │          │
│        │   书写效果    │          │
│        │               │          │
│        ╰──────────────╯          │
│                                  │
│    正在为你出题，请稍等...        │
│                                  │
│    已生成 2/5 题                  │
│    ━━━━━━━━░░░░░░░░░  40%        │
│                                  │
│                                  │
│                                  │
└──────────────────────────────────┘
```

### 场景四：通用加载（兜底方案）

```
┌──────────────────────────────────┐
│ ◀ 返回        页面标题      ...  │
│──────────────────────────────────│
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
│              ╭───╮               │
│              │ ◠ │               │
│              ╰───╯               │
│           旋转加载动画            │
│                                  │
│          加载中...               │
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
│                                  │
└──────────────────────────────────┘
```

### 超时状态（15 秒后）

```
┌──────────────────────────────────┐
│ ◀ 返回        页面标题      ...  │
│──────────────────────────────────│
│                                  │
│         ┌──────────┐             │
│         │ 小花老师  │             │
│         │  (努力)   │             │
│         └──────────┘             │
│                                  │
│        ╭──────────────╮          │
│        │  对应场景动画  │          │
│        │  （继续播放） │          │
│        ╰──────────────╯          │
│                                  │
│     处理时间较长，请耐心等待      │
│                                  │
│    ┌────────────────────┐        │
│    │   趣味知识/学习小   │        │
│    │   贴士轮播显示      │        │
│    └────────────────────┘        │
│                                  │
│                                  │
└──────────────────────────────────┘
```

### 超时状态（30 秒后）

```
┌──────────────────────────────────┐
│ ◀ 返回        页面标题      ...  │
│──────────────────────────────────│
│                                  │
│         ┌──────────┐             │
│         │ 小花老师  │             │
│         │  (抱歉)   │             │
│         └──────────┘             │
│                                  │
│    "不好意思，等太久了"           │
│                                  │
│                                  │
│    ┌────────────────────────┐    │
│    │                        │    │
│    │  处理时间过长，你可以：  │    │
│    │                        │    │
│    │  ┌────────┐ ┌───────┐  │    │
│    │  │  重试   │ │ 取消  │  │    │
│    │  └────────┘ └───────┘  │    │
│    │                        │    │
│    └────────────────────────┘    │
│                                  │
│                                  │
└──────────────────────────────────┘
```

## 元素说明

| 元素 | 类型 | 说明 |
|------|------|------|
| 数字人形象 | 动态图像 | 尺寸视场景而定：页面内嵌 100x100pt / 浮层内 80x80pt |
| AI 思考动画（大脑） | Lottie 动画 | 大脑齿轮转动效果，尺寸 80x80pt，循环播放 |
| OCR 扫描线 | 动画组件 | 蓝色半透明横线，从上到下匀速移动，循环播放，速度 2s/次 |
| 铅笔书写动画 | Lottie 动画 | 铅笔在纸上书写效果，尺寸 80x80pt，循环播放 |
| 通用旋转加载 | 动画组件 | 主题色圆弧旋转，尺寸 40x40pt，速度 1s/圈 |
| 加载提示文字 | 文字 | 字号 15pt，灰色，居中对齐 |
| 进度条 | 进度指示器 | 有明确进度时显示百分比进度条，无明确进度时显示不定进度条 |
| 趣味知识卡片 | 卡片 | 浅色背景，圆角 12px，显示趣味知识或学习小贴士 |
| 超时提示文字 | 文字 | 字号 14pt，橙色，居中显示 |
| 重试按钮 | 主按钮 | 主题色填充，圆角 24px，高 44pt |
| 取消按钮 | 次要按钮 | 灰色边框，圆角 24px，高 44pt |

## 交互行为

### 手势交互
- **返回按钮**：点击返回上一页（加载过程中允许取消返回）
- **重试按钮**：点击后重新发起请求，回到初始加载状态
- **取消按钮**：点击后取消当前操作，回到操作前页面状态
- **下拉页面**：加载过程中禁止下拉刷新，避免冲突

### 输入交互
- 加载过程中禁用输入，防止用户重复提交
- 加载完成后自动恢复所有输入功能

### 动画与反馈

#### AI 思考动画
- 大脑齿轮旋转，速度 1.5s/圈
- 齿轮间歇性加速，模拟思考"灵感闪现"效果
- 配合粒子效果（小星星/光点）

#### OCR 扫描动画
- 蓝色扫描线从上到下匀速移动
- 扫描线经过区域高亮显示已识别文字
- 识别完成区域变为绿色确认

#### 生成题目动画
- 铅笔在虚拟纸张上书写
- 每生成一题，显示完成打勾动画
- 进度文字实时更新（"已生成 X/Y 题"）

#### 通用加载动画
- 主题色圆弧 360 度旋转
- 旋转速度 1s/圈，匀速

#### 超时过渡动画
- 15 秒超时：提示文字淡入显示，动画继续播放
- 30 秒超时：当前动画缩小移至上方，操作按钮从下方滑入

### AI 老师交互
- **AI 思考场景**：思考表情，手托下巴，偶尔眨眼
- **OCR 扫描场景**：专注表情，眼睛跟随扫描线移动
- **生成题目场景**：书写表情，手部做书写动作
- **通用加载场景**：数字人不显示（仅通用旋转动画）
- **15 秒超时**：表情切换为"努力/加油"，做出擦汗动作
- **30 秒超时**：表情切换为"抱歉"，微微鞠躬

## 状态枚举

### 默认加载状态（0~15 秒）
- 显示对应场景的加载动画
- 显示加载提示文字
- 如有明确进度则显示进度条
- 3 秒后开始轮播趣味知识卡片（AI 思考场景专用）

### 长时间等待状态（15~30 秒）
- 加载动画继续播放
- 提示文字变更为："处理时间较长，请耐心等待"
- 提示文字颜色由灰色变为橙色
- 趣味知识卡片加速轮播（每 5 秒切换一条）

### 超时操作状态（30 秒以上）
- 加载动画缩小并移至上方
- 显示"处理时间过长"说明
- 出现"重试"和"取消"操作按钮
- 小花老师表情切换为抱歉

### 加载成功状态
- 加载动画播放完成动效（如打勾、绽放效果）
- 300ms 后过渡到结果页面
- 小花老师切换为开心/自信表情

### 加载失败状态
- 加载动画停止
- 显示错误信息（具体错误参见 G4 网络异常状态）
- 提供重试按钮
- 小花老师切换为抱歉表情

### 边界情况
- **用户加载中返回**：弹出确认弹窗"正在处理中，确定要离开吗？"，提供"继续等待"和"离开"选项
- **多个加载并行**：优先显示主操作加载状态，次要操作在后台静默加载
- **加载中网络断开**：立即切换到 G4 网络异常状态
- **加载中 App 进入后台**：后台继续请求，回到前台后显示最新状态
- **弱网环境**：自动降低请求超时阈值，更快触发超时提示
- **进度回退**：服务端返回的进度值不得小于前值，前端做单调递增保护
- **内容页部分加载**：支持骨架屏（Skeleton）渐进式加载，先显示已有内容框架

## 导航关系

### 从哪来
- **G1 语音交互浮层**：用户提问后进入 AI 思考加载
- **拍照上传页**：拍照后进入 OCR 扫描加载
- **练习模式页**：生成练习题时进入生成题目加载
- **知识点页面**：加载知识点详情时显示通用加载
- **任意数据请求页**：页面数据请求时显示通用加载
- **学习报告页**：生成学习报告时显示 AI 思考加载

### 到哪去
- **AI 回答结果页**：AI 思考加载完成后跳转
- **题目识别结果页**：OCR 扫描完成后跳转
- **练习题列表页**：题目生成完成后跳转
- **当前页面（数据就绪）**：通用加载完成后展示页面内容
- **G4 网络异常状态**：加载过程中网络异常时切换
- **操作前页面**：用户点击取消后回到操作前状态
