# F3 声纹管理

## 页面信息
- **所属模块**：F 系列 - 账户与设置
- **页面类型**：全屏页
- **数字人老师**：不显示
- **支持模式**：通用（家长模式可管理所有成员声纹，学生模式仅可管理自己的声纹）

## 线框图

### 主界面 - 声纹列表

```
┌──────────────────────────────────┐
│ 状态栏                       ▐██ │
├──────────────────────────────────┤
│  ←  声纹管理                     │
├──────────────────────────────────┤
│                                  │
│  声纹用于自动识别家庭成员身份，   │
│  请在安静环境下录入。             │
│                                  │
│  ── 已录入 ────────────────────  │
│                                  │
│  ┌────────────────────────────┐  │
│  │ ┌────┐                    │  │
│  │ │头像│ 张爸爸     [重新录入]│  │
│  │ └────┘ 录入时间 2025-12-01 │  │
│  │        声纹质量：优 ██████  │  │
│  └────────────────────────────┘  │
│                                  │
│  ┌────────────────────────────┐  │
│  │ ┌────┐                    │  │
│  │ │头像│ 张妈妈     [重新录入]│  │
│  │ └────┘ 录入时间 2025-12-01 │  │
│  │        声纹质量：优 ██████  │  │
│  └────────────────────────────┘  │
│                                  │
│  ┌────────────────────────────┐  │
│  │ ┌────┐                    │  │
│  │ │头像│ 张小明     [重新录入]│  │
│  │ └────┘ 录入时间 2025-12-03 │  │
│  │        声纹质量：良 █████░  │  │
│  └────────────────────────────┘  │
│                                  │
│  ── 未录入 ────────────────────  │
│                                  │
│  ┌────────────────────────────┐  │
│  │ ┌────┐                    │  │
│  │ │头像│ 张小红     [去录入]  │  │
│  │ └────┘ 学生 · 一年级       │  │
│  │        ⚠ 未录入声纹         │  │
│  └────────────────────────────┘  │
│                                  │
└──────────────────────────────────┘
```

### 声纹录入界面

```
┌──────────────────────────────────┐
│ 状态栏                       ▐██ │
├──────────────────────────────────┤
│  ←  录入声纹 - 张小红            │
├──────────────────────────────────┤
│                                  │
│         请朗读以下文字：          │
│                                  │
│  ┌────────────────────────────┐  │
│  │                            │  │
│  │  "小花老师你好，我是张小红，│  │
│  │   今天天气真不错，我们一起   │  │
│  │   来学习有趣的知识吧。"     │  │
│  │                            │  │
│  └────────────────────────────┘  │
│                                  │
│      环境噪音：安静 🟢            │
│                                  │
│  ┌────────────────────────────┐  │
│  │                            │  │
│  │  ▁ ▃ ▅ ▇ ▅ ▃ ▁ ▃ ▅ ▇ ▅  │  │
│  │  ▁ ▃ ▅ ▇ ▅ ▃ ▁ ▃ ▅ ▇ ▅  │  │
│  │                            │  │
│  │      实时录音波形可视化      │  │
│  └────────────────────────────┘  │
│                                  │
│       录入进度：6s / 10s         │
│  ┌────────────────────────────┐  │
│  │ ██████████████░░░░░░░░░░░░ │  │
│  └────────────────────────────┘  │
│       还需朗读约 4 秒            │
│                                  │
│         ┌──────────┐             │
│         │          │             │
│         │  ● 录音中 │             │
│         │          │             │
│         └──────────┘             │
│        点击暂停 / 长按取消        │
│                                  │
└──────────────────────────────────┘
```

### 环境噪音过高警告

```
┌──────────────────────────────────┐
│                                  │
│      环境噪音：嘈杂 🔴            │
│                                  │
│  ┌────────────────────────────┐  │
│  │  ⚠ 当前环境噪音过高         │  │
│  │                            │  │
│  │  建议您：                   │  │
│  │  · 移动到安静的室内环境      │  │
│  │  · 关闭电视、音响等声源      │  │
│  │  · 远离空调、风扇等噪声      │  │
│  │                            │  │
│  │  噪音等级：█████████░ 72dB  │  │
│  │  建议低于：█████░░░░░ 45dB  │  │
│  │                            │  │
│  │  [ 仍然继续 ]  [ 稍后再试 ] │  │
│  └────────────────────────────┘  │
│                                  │
└──────────────────────────────────┘
```

### 录入成功状态

```
┌──────────────────────────────────┐
│ 状态栏                       ▐██ │
├──────────────────────────────────┤
│  ←  录入声纹 - 张小红            │
├──────────────────────────────────┤
│                                  │
│                                  │
│                                  │
│            ┌──────┐              │
│            │  ✓   │              │
│            │ 动画  │              │
│            └──────┘              │
│                                  │
│         声纹录入成功！            │
│                                  │
│      声纹质量评估：优             │
│      ██████████████ 92分         │
│                                  │
│      小花老师现在可以通过         │
│      声音识别出张小红啦！         │
│                                  │
│                                  │
│      ┌────────────────────┐      │
│      │      完成返回       │      │
│      └────────────────────┘      │
│                                  │
│      ┌────────────────────┐      │
│      │      重新录入       │      │
│      └────────────────────┘      │
│                                  │
│                                  │
└──────────────────────────────────┘
```

### 录入失败状态

```
┌──────────────────────────────────┐
│ 状态栏                       ▐██ │
├──────────────────────────────────┤
│  ←  录入声纹 - 张小红            │
├──────────────────────────────────┤
│                                  │
│                                  │
│                                  │
│            ┌──────┐              │
│            │  ✗   │              │
│            │ 动画  │              │
│            └──────┘              │
│                                  │
│         声纹录入失败              │
│                                  │
│      可能原因：                   │
│      · 录音中断或不完整           │
│      · 环境噪音过大干扰          │
│      · 朗读内容与提示文字不符     │
│                                  │
│      建议在安静环境下             │
│      按照提示文字重新朗读         │
│                                  │
│      ┌────────────────────┐      │
│      │      重新录入       │      │
│      └────────────────────┘      │
│                                  │
│      ┌────────────────────┐      │
│      │      稍后再试       │      │
│      └────────────────────┘      │
│                                  │
└──────────────────────────────────┘
```

## 元素说明

| 序号 | 元素名称 | 类型 | 说明 |
|------|---------|------|------|
| 1 | 导航栏 | 顶部导航 | 左侧返回箭头 + 标题，录入模式下标题包含成员姓名 |
| 2 | 页面说明文字 | 文本 | 14pt 灰色说明文字，引导用户了解声纹作用和录入条件 |
| 3 | 分组标题 | 文本 | "已录入"/"未录入"分组标签，12pt 灰色 |
| 4 | 声纹卡片 | 卡片容器 | 白色圆角卡片，展示成员头像、姓名、录入时间、声纹质量 |
| 5 | 声纹质量条 | 进度条 | 6 段式质量指示条，优（绿色满格）、良（绿色5格）、中（黄色4格）、差（红色需重录） |
| 6 | 重新录入按钮 | 文字按钮 | 蓝色文字，14pt，位于卡片右上角 |
| 7 | 去录入按钮 | 文字按钮 | 橙色文字，14pt，位于未录入卡片右上角 |
| 8 | 朗读提示文本框 | 文本卡片 | 浅黄色背景圆角卡片，内含需朗读的引导文字，16pt 黑色 |
| 9 | 噪音等级指示器 | 状态标签 | 实时显示环境噪音等级：安静（绿色）、一般（黄色）、嘈杂（红色） |
| 10 | 录音波形可视化 | 动态图形 | 实时音频波形显示区域，宽度满屏，高度 80pt，波形颜色为主题蓝色 |
| 11 | 录入进度条 | 进度条组件 | 显示已录入时长 / 所需时长（10秒），线性进度条 + 数字标注 |
| 12 | 剩余时间提示 | 文本 | 进度条下方，动态显示"还需朗读约 X 秒" |
| 13 | 录音控制按钮 | 圆形按钮 | 直径 72pt，录音中红色脉动圆点，未录音灰色麦克风图标 |
| 14 | 成功动画 | Lottie 动画 | 绿色圆形打勾动画，120x120pt |
| 15 | 失败动画 | Lottie 动画 | 红色圆形叉号动画，120x120pt |
| 16 | 声纹质量评分 | 文本 + 进度条 | 成功页展示，百分制评分 + 彩色进度条 |

## 交互行为

### 手势交互
- **返回手势**：从屏幕左边缘右滑返回列表页或上级页面
- **录音取消**：长按录音按钮 2 秒后松手可取消当前录音
- **列表滚动**：声纹列表支持上下滚动
- **卡片点击**：已录入的卡片点击可展开查看声纹详情

### 输入交互
- **开始录音**：点击麦克风按钮开始录音，按钮变为红色脉动状态
- **暂停录音**：录音过程中点击按钮暂停，再次点击继续，进度保留
- **取消录音**：长按按钮 2 秒取消录音，进度归零
- **重新录入**：点击「重新录入」进入录入界面，覆盖旧声纹数据
- **噪音警告**：检测到噪音过高时自动弹出提示，用户可选择继续或退出

### 动画与反馈
- **录音波形**：实时绘制音频振幅波形，帧率 30fps，平滑插值显示，颜色随音量从蓝渐变到红
- **录音按钮脉动**：录音状态下按钮外圈有红色圆环呼吸脉动动画（周期 1.5s）
- **进度条动画**：进度条平滑增长，无跳跃
- **噪音指示器**：实时更新，有颜色渐变过渡动画（300ms）
- **成功动画**：打勾图标先缩小后弹出（spring 弹性动画 500ms），随后散射粒子庆祝效果
- **失败动画**：叉号图标左右摇摆（shake 动画 400ms），红色渐现
- **页面转场**：录入完成后返回列表页，更新对应卡片状态（淡入更新 300ms）
- **触觉反馈**：录音开始、暂停、完成时触发轻微震动（Haptic Feedback）

### AI 老师交互
- 本页面不直接显示 AI 老师
- 录入完成后若声纹质量为"差"，会提示用户"建议重新录入以获得更好的识别效果"

## 状态枚举

### 默认状态
- 声纹列表正常展示，分"已录入"和"未录入"两组
- 已录入成员显示录入时间和质量评分
- 未录入成员显示「去录入」入口

### 空状态
- 所有成员均未录入声纹时：
  - 显示引导插画（麦克风图形）
  - 文案："还没有人录入声纹，录入声纹后小花老师就能认出每个人啦"
  - 显示成员列表，每个成员都有「去录入」按钮

### 加载状态
- 进入页面时列表区域显示骨架屏
- 录音处理中（录音完成后分析声纹阶段）：
  - 录音按钮变为 loading 旋转动画
  - 文案显示"正在分析声纹特征..."
  - 预计耗时 2-5 秒

### 错误状态
- **麦克风权限未授予**：弹窗提示"需要麦克风权限才能录入声纹"，引导跳转系统设置
- **录音中断**：因来电或其他中断导致录音失败，提示"录音被中断，请重新开始"，进度不保留
- **网络异常**：声纹上传失败时提示"声纹保存失败，请检查网络后重试"，录音数据本地暂存，支持重新上传
- **声纹分析失败**：提示"声纹分析失败，可能是录音质量不佳"，建议重新录入

### 边界情况
- **麦克风被占用**：其他 App 占用麦克风时提示"麦克风被其他应用占用，请关闭后重试"
- **录音时间不足**：未达到 10 秒有效语音时不允许提交，提示"录音时长不足，请继续朗读"
- **重复声纹检测**：若新录入声纹与已有成员声纹过于相似（相似度 > 95%），提示"该声纹与 [成员名] 非常相似，请确认是否为本人录入"
- **低电量**：电量低于 5% 时提示"电量过低，建议充电后再录入声纹"
- **静音模式**：检测到设备静音时提示"请确保设备未静音，以便播放引导语音"
- **超时处理**：录音开始后 60 秒内未达到 10 秒有效语音自动终止，提示"录音超时"

## 导航关系

### 从哪来
| 来源页面 | 触发方式 | 转场动画 | 携带参数 |
|---------|---------|---------|---------|
| F1 个人中心 | 点击「声纹管理」菜单项 | 右滑推入（push） | 无（显示全部成员） |
| F2 家庭成员管理 | 详情弹层点击「管理声纹」 | 右滑推入（push） | member_id（自动定位到该成员并展开录入） |

### 到哪去
| 目标页面 | 触发方式 | 转场动画 |
|---------|---------|---------|
| F1 个人中心 | 左上角返回（从 F1 进入时） | 左滑退出（pop） |
| F2 家庭成员管理 | 左上角返回（从 F2 进入时） | 左滑退出（pop） |
