# G2 权限请求弹窗

## 页面信息
- **所属模块**：全局组件（G 系列）
- **页面类型**：弹窗
- **数字人老师**：小/弹窗内显示（配合说明插图出现）
- **支持模式**：通用（学生模式与家长模式均可触发）

## 线框图

### 第一步：自定义说明页（以麦克风权限为例）

```
┌──────────────────────────────────┐
│          （当前页面内容）          │
│    （半透明黑色遮罩 60% 透明度）   │
│                                  │
│   ┌────────────────────────┐     │
│   │                        │     │
│   │   ┌──────────────────┐ │     │
│   │   │                  │ │     │
│   │   │   ┌──────────┐   │ │     │
│   │   │   │  小花老师  │   │ │     │
│   │   │   │ 手持麦克风 │   │ │     │
│   │   │   └──────────┘   │ │     │
│   │   │                  │ │     │
│   │   │  声波动画插图     │ │     │
│   │   └──────────────────┘ │     │
│   │                        │     │
│   │   需要使用你的麦克风    │     │
│   │                        │     │
│   │   小花老师需要听到你的  │     │
│   │   声音，才能和你语音    │     │
│   │   对话、解答问题哦~    │     │
│   │                        │     │
│   │   ┌─────┐  ┌────────┐ │     │
│   │   │ 暂不 │  │ 好的开启│ │     │
│   │   └─────┘  └────────┘ │     │
│   │                        │     │
│   └────────────────────────┘     │
│                                  │
└──────────────────────────────────┘
```

### 第二步：系统权限弹窗（系统原生）

```
┌──────────────────────────────────┐
│          （当前页面内容）          │
│                                  │
│                                  │
│   ┌────────────────────────┐     │
│   │                        │     │
│   │  "小花老师"想访问你的   │     │
│   │   麦克风                │     │
│   │                        │     │
│   │   用于语音交互，让小花  │     │
│   │   老师听到你的问题      │     │
│   │                        │     │
│   │  ──────────────────── │     │
│   │       不允许            │     │
│   │  ──────────────────── │     │
│   │        允许             │     │
│   │                        │     │
│   └────────────────────────┘     │
│                                  │
│                                  │
└──────────────────────────────────┘
```

### 权限被拒绝后的引导弹窗

```
┌──────────────────────────────────┐
│          （当前页面内容）          │
│    （半透明黑色遮罩 60% 透明度）   │
│                                  │
│   ┌────────────────────────┐     │
│   │                        │     │
│   │   ┌──────────────────┐ │     │
│   │   │   小花老师（委屈） │ │     │
│   │   │   听不到你说话...  │ │     │
│   │   └──────────────────┘ │     │
│   │                        │     │
│   │   麦克风权限未开启      │     │
│   │                        │     │
│   │   没有麦克风权限，      │     │
│   │   以下功能将无法使用：  │     │
│   │                        │     │
│   │   ✗ 语音提问            │     │
│   │   ✗ 语音唤醒小花老师    │     │
│   │   ✗ 口语练习            │     │
│   │                        │     │
│   │   你仍然可以使用：      │     │
│   │   ✓ 文字输入提问        │     │
│   │   ✓ 拍照上传题目        │     │
│   │                        │     │
│   │   ┌─────┐ ┌──────────┐│     │
│   │   │我知道│ │去设置开启 ││     │
│   │   └─────┘ └──────────┘│     │
│   │                        │     │
│   └────────────────────────┘     │
│                                  │
└──────────────────────────────────┘
```

### 各权限自定义说明页汇总

```
┌─────────────┬─────────────────────────┐
│    权限      │        说明页内容        │
├─────────────┼─────────────────────────┤
│             │ 插图：小花老师手持麦克风  │
│  麦克风      │ 标题：需要使用你的麦克风  │
│             │ 说明：小花老师需要听到你  │
│             │ 的声音，才能语音对话     │
├─────────────┼─────────────────────────┤
│             │ 插图：小花老师举着相机    │
│  相机        │ 标题：需要使用你的相机    │
│             │ 说明：拍下不会的题目，    │
│             │ 小花老师帮你分析解答     │
├─────────────┼─────────────────────────┤
│             │ 插图：小花老师翻看相册    │
│  相册        │ 标题：需要访问你的相册    │
│             │ 说明：从相册选择题目照片  │
│             │ 发给小花老师批改         │
├─────────────┼─────────────────────────┤
│             │ 插图：小花老师摇铃铛      │
│  通知        │ 标题：开启消息通知       │
│             │ 说明：及时收到学习提醒、  │
│             │ 作业反馈和鼓励消息       │
└─────────────┴─────────────────────────┘
```

## 元素说明

| 元素 | 类型 | 说明 |
|------|------|------|
| 遮罩层 | 背景 | 半透明黑色，透明度 60%，不可点击关闭（强引导） |
| 弹窗卡片 | 容器 | 宽度占屏幕 80%，圆角 16px，居中显示，白色背景 |
| 插图区域 | 图片 | 尺寸 200x150pt，居中显示，含小花老师形象和场景插图 |
| 权限标题 | 文字 | 字号 18pt，加粗，深色，居中对齐 |
| 权限说明 | 文字 | 字号 14pt，灰色，居中对齐，最多 3 行 |
| "暂不"按钮 | 次要按钮 | 灰色文字，无填充，宽度 40%，高 44pt |
| "好的开启"按钮 | 主按钮 | 主题色填充，白色文字，宽度 55%，高 44pt |
| 功能受限列表 | 列表 | 红色 ✗ 标记不可用功能，绿色 ✓ 标记可用功能 |
| "去设置开启"按钮 | 主按钮 | 跳转系统设置页面 |
| "我知道"按钮 | 次要按钮 | 关闭弹窗，接受降级体验 |

## 交互行为

### 手势交互
- **点击遮罩区域**：不关闭弹窗（权限请求为强引导流程）
- **点击"好的开启"**：触发系统原生权限弹窗
- **点击"暂不"**：关闭自定义弹窗，记录用户拒绝，后续触发时显示精简版提示
- **点击"去设置开启"**：打开系统设置 App 对应权限页面（使用 Deep Link）
- **点击"我知道"**：关闭弹窗，进入降级模式

### 输入交互
- 本页面无输入交互，纯点击操作

### 动画与反馈
- **弹窗弹出**：缩放 + 淡入动画，从 0.8 倍缩放至 1.0 倍，时长 250ms
- **弹窗关闭**：缩放 + 淡出动画，从 1.0 倍缩小至 0.9 倍 + 淡出，时长 200ms
- **插图动画**：小花老师形象有微动效，如麦克风权限页声波扩散动画
- **按钮点击**：按下缩小至 0.95 倍，松开恢复，时长 100ms
- **触觉反馈**：点击主按钮时中等触觉反馈

### AI 老师交互
- **说明页**：小花老师以友好形象出现在插图中，配合场景动作
- **被拒绝页**：小花老师显示轻微委屈/遗憾表情，增加情感引导
- **权限开启成功**：小花老师短暂出现开心表情 + "太好了！" 气泡（Toast 提示 1.5 秒）

## 状态枚举

### 默认状态（自定义说明页）
- 显示对应权限的插图和说明文字
- 两个按钮可点击
- 遮罩不可关闭

### 系统权限弹窗态
- 自定义弹窗隐藏
- 系统原生权限弹窗显示
- 等待用户操作系统弹窗

### 权限授予成功态
- 系统弹窗关闭
- 显示成功 Toast："权限已开启"
- 小花老师开心表情
- 自动关闭弹窗，回到触发页面
- 1 秒后自动执行原本需要权限的操作

### 权限被拒绝态（首次拒绝）
- 显示降级体验说明弹窗
- 列出不可用功能和仍可用功能
- 提供"去设置开启"和"我知道"两个选项

### 权限被拒绝态（多次拒绝）
- 同首次拒绝态，但文案调整为更温和版本
- 不再频繁弹出，改为在具体功能入口处显示小提示
- 每 7 天最多主动提示 1 次

### 边界情况
- **系统权限已授予**：直接执行操作，不显示任何弹窗
- **系统设置中手动关闭已授予权限**：下次使用相关功能时重新触发引导弹窗
- **iOS"不再询问"状态**：跳过系统弹窗，直接显示去设置引导
- **Android 永久拒绝**：识别永久拒绝状态，直接引导去系统设置
- **家长模式**：权限说明文案切换为面向家长的版本（如"允许孩子使用语音和小花老师交流"）
- **多个权限同时需要**：按优先级依次请求，不同时弹出多个（优先级：麦克风 > 相机 > 相册 > 通知）

## 导航关系

### 从哪来
- **G1 语音交互浮层**：首次使用语音功能，麦克风权限未授权时触发
- **拍照上传页**：首次使用拍照功能，相机/相册权限未授权时触发
- **首次启动引导流**：引导过程中依次请求必要权限
- **设置页手动开启**：用户在 App 设置中点击"开启 XX 权限"
- **学习提醒设置**：开启学习提醒时，通知权限未授权时触发

### 到哪去
- **触发页面**：权限授予成功后回到触发页面，继续原操作
- **触发页面（降级）**：权限拒绝后回到触发页面，相关功能降级显示
- **系统设置页**：点击"去设置开启"跳转系统设置
