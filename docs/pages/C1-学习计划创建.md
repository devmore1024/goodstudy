# C1 学习计划创建

## 页面信息
- **所属模块**：C - 学习计划模块
- **页面类型**：全屏页
- **数字人老师**：大/居中（对话主导模式）
- **支持模式**：通用（学生模式与家长模式均可进入，家长模式下可代孩子创建）

## 线框图

```
┌──────────────────────────────────┐
│ ←  创建学习计划          步骤1/5 │
├──────────────────────────────────┤
│                                  │
│        ┌──────────────┐          │
│        │              │          │
│        │   数字人老师  │          │
│        │  （大/居中）  │          │
│        │   说话动画    │          │
│        └──────────────┘          │
│                                  │
│  ── 步骤1：学情总览+自选方向 ──  │
│                                  │
│  ┌──────────────────────────┐    │
│  │ "我看了你上传的数学试卷， │    │
│  │  了解到你在应用题方面      │    │
│  │  比较薄弱..."             │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │ 📊 数学诊断摘要（有试卷） │    │
│  │  得分：85/100              │    │
│  │  薄弱点：应用题、几何      │    │
│  │  AI建议：重点加强应用题    │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │ "语文还没有试卷数据，     │    │
│  │  你觉得自己语文哪方面     │    │
│  │  需要加强呢？"            │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │ 📝 语文学习方向（自选）    │    │
│  │ ┌────────┐ ┌────────┐    │    │
│  │ │阅读理解 │ │作文写作 │    │    │
│  │ ├────────┤ ├────────┤    │    │
│  │ │古诗文   │ │基础字词 │    │    │
│  │ ├────────┤                │    │
│  │ │我不确定 │                │    │
│  │ └────────┘                │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │ 📝 英语学习方向（自选）    │    │
│  │ ┌────────┐ ┌────────┐    │    │
│  │ │单词记忆 │ │阅读理解 │    │    │
│  │ ├────────┤ ├────────┤    │    │
│  │ │听力    │ │语法     │    │    │
│  │ ├────────┤                │    │
│  │ │我不确定 │                │    │
│  │ └────────┘                │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │         下一步 →          │    │
│  └──────────────────────────┘    │
│                                  │
│  ── 步骤2：每周时间安排 ──      │
│                                  │
│  ┌──────────────────────────┐    │
│  │ "根据你的情况，我建议     │    │
│  │  每周安排以下学习时间…"   │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │     📅 每周时间安排       │    │
│  │  ┌─┬─┬─┬─┬─┬─┬─┐       │    │
│  │  │一│二│三│四│五│六│日│  │    │
│  │  ├─┼─┼─┼─┼─┼─┼─┤       │    │
│  │  │08│  │  │  │  │██│██│  │    │
│  │  │09│  │  │  │  │██│██│  │    │
│  │  │10│██│  │██│  │██│  │  │    │
│  │  │11│██│  │██│  │  │  │  │    │
│  │  │..│  │  │  │  │  │  │  │    │
│  │  │16│  │██│  │██│  │  │  │    │
│  │  │17│  │██│  │██│  │  │  │    │
│  │  │18│██│  │██│  │  │  │  │    │
│  │  │19│██│  │██│  │██│  │  │    │
│  │  │20│  │  │  │  │  │  │  │    │
│  │  └─┴─┴─┴─┴─┴─┴─┘       │    │
│  │  ██ = AI推荐时段          │    │
│  │  长按拖拽可调整时段       │    │
│  └──────────────────────────┘    │
│                                  │
│  ── 步骤3：科目时间分配 ──      │
│                                  │
│  ┌──────────────────────────┐    │
│  │     科目时间分配          │    │
│  │  语文   ━━━━●━━━━━━  4h   │    │
│  │  数学   ━━━━━━━●━━  6h   │    │
│  │  英语   ━━━━━●━━━━  5h   │    │
│  │          总计: 15h/周     │    │
│  └──────────────────────────┘    │
│                                  │
│  ── 步骤4：测评频率 ──          │
│                                  │
│  ┌──────────────────────────┐    │
│  │     测评频率              │    │
│  │  ┌────┐ ┌────┐ ┌────┐   │    │
│  │  │每周│ │每两周│ │每月│   │    │
│  │  │    │ │[选中]│ │    │   │    │
│  │  └────┘ └────┘ └────┘   │    │
│  └──────────────────────────┘    │
│                                  │
│  ── 步骤5：确认计划 ──          │
│                                  │
│  ┌──────────────────────────┐    │
│  │ 💬 "我想周末多学一点数学" │    │
│  │                     🎤   │    │
│  └──────────────────────────┘    │
│                                  │
│  ┌──────────────────────────┐    │
│  │      确认生成计划 →       │    │
│  └──────────────────────────┘    │
└──────────────────────────────────┘
```

## 元素说明

| 序号 | 元素名称 | 类型 | 说明 |
|------|---------|------|------|
| 1 | 导航栏 | 固定顶栏 | 左侧返回按钮，中间标题，右侧显示步骤进度（步骤1/5） |
| 2 | 数字人老师区域 | 动态组件 | 居中大尺寸展示，有说话口型动画、手势动画，高度约占屏幕30% |
| 3 | AI对话气泡 | 文本气泡 | 显示AI老师当前说的话，支持打字机效果逐字出现 |
| 4 | 诊断摘要卡片 | 信息卡片 | 仅对有试卷数据的科目显示，展示得分、薄弱点、AI建议重点，白色卡片圆角12pt |
| 5 | 学习方向选择器 | 多选标签组 | 仅对无试卷数据的科目显示，嵌入对话气泡下方，按科目分组，支持多选 |
| 6 | 每周时间安排网格 | 可交互表格 | 横轴为周一至周日，纵轴为8:00-21:00时段（每30分钟一格），AI预填推荐时段（蓝色高亮），用户可长按拖拽选择/取消时段 |
| 7 | 科目时间分配滑块 | 滑块组 | 固定三个科目：语文、数学、英语，显示科目名称、当前分配时长，滑块联动（总时间不超过网格选择的总时长），底部显示总计时长 |
| 8 | 测评频率选择器 | 单选按钮组 | 三个选项卡片：每周、每两周、每月，AI推荐项有"推荐"标签，选中态有蓝色边框和勾选图标 |
| 9 | 语音/文字输入栏 | 底部输入组件 | 支持语音输入（默认）和文字输入切换，用户可通过自然语言调整计划 |
| 10 | 确认按钮 | 主按钮 | 固定底部，点击后进入计划确认与生成流程 |

### 步骤 1 详细说明：学情总览 + 自选学习方向

#### 诊断摘要卡片（有试卷数据的科目）
- **位置**：AI 总结对话气泡下方
- **样式**：白色卡片，圆角 12pt，左侧有科目色条（语文绿、数学蓝、英语橙）
- **内容**：
  - 科目名称 + 📊 图标
  - 得分：XX/XX
  - 薄弱点：以标签形式展示（如「应用题」「几何」）
  - AI 建议重点：一句话文字说明
- **交互**：只读展示，点击可展开查看详细分析

#### 学习方向选择器（无试卷数据的科目）
- **位置**：AI 询问对话气泡下方，嵌入对话流中
- **样式**：白色卡片，圆角 12pt，标题带 📝 图标 + 科目名称
- **按科目选项**：
  - **语文**：阅读理解 / 作文写作 / 古诗文 / 基础字词 / 我不确定
  - **数学**：计算能力 / 应用题 / 几何图形 / 概念理解 / 我不确定
  - **英语**：单词记忆 / 阅读理解 / 听力 / 语法 / 我不确定
- **选项样式**：胶囊形标签按钮，未选中为白色背景灰色边框，选中为品牌色浅背景 + 品牌色边框
- **交互**：
  - 支持多选（一个科目可选多个方向）
  - 选「我不确定」时自动取消该科目其他选项，互斥
  - 选其他选项时自动取消「我不确定」
- **AI 反馈**：
  - 选择具体方向后，AI 语音回应「好的，我会在[方向]方面重点帮你提升！」
  - 选「我不确定」后，AI 语音回应「没关系，我会帮你全面学习，学习中再调整~」（后端使用均衡方案）

#### 步骤 1「下一步」按钮
- **位置**：学习方向选择器下方
- **激活条件**：每个无试卷数据的科目都已选择至少一个方向（或选了「我不确定」）
- **样式**：品牌色渐变，圆角 24pt，高 48pt
- **点击后**：滚动至步骤 2（每周时间安排）

## 交互行为

### 手势交互
- **时间网格拖拽**：长按某个时间格子后进入编辑模式，手指拖拽可连续选中或取消多个时间格子，格子选中时有轻微放大+颜色填充动画
- **滑块拖拽**：左右拖拽科目时间滑块，实时更新时长数字，当总时长超出可用时长时滑块阻尼增大并震动提示
- **上下滚动**：页面整体可纵向滚动，数字人老师区域滚动时缩小为顶部小尺寸悬浮
- **左右滑动气泡**：AI对话历史可左右滑动查看之前的对话内容
- **学习方向标签点击**：点击选中/取消选中，选中时标签缩放弹性动画

### 输入交互
- **语音输入**：点击麦克风图标开始录音，再次点击结束，语音转文字后发送给AI老师处理
- **文字输入**：点击输入框切换为键盘输入模式，支持发送文字指令（如"数学时间加到8小时"）
- **AI语义解析**：用户输入的自然语言会被AI解析，自动调整对应的UI控件（如时间滑块、网格选择等），并给出语音反馈

### 动画与反馈
- **页面进入**：数字人老师从底部弹起，配合欢迎语音
- **步骤 1 进入**：
  - 有试卷数据时：AI 说话气泡逐字出现 + 诊断摘要卡片从右侧滑入
  - 无试卷数据时：AI 询问气泡逐字出现 + 学习方向选择器从底部淡入
- **学习方向选择**：选中标签时有弹性缩放动画 + 品牌色填充动画，AI 实时语音回应
- **AI推荐填充**：时间网格中AI推荐的时段以波浪动画逐个填充，从上到下依次亮起
- **滑块联动动画**：调整一个科目滑块时，其他科目滑块平滑联动调整
- **确认按钮**：所有必填项完成后按钮从灰色渐变为蓝色，带呼吸光效
- **震动反馈**：时间冲突、滑块到达极值时触发轻微震动（Haptic Feedback）

### AI 老师交互
- **步骤引导**：AI老师按步骤引导用户完成计划创建：① 学情总览+自选方向 → ② 时间安排 → ③ 科目分配 → ④ 测评频率 → ⑤ 确认
- **学情总结（步骤 1）**：
  - 有试卷数据时：「我看了你上传的[科目]试卷，了解到你在[知识点]方面比较薄弱，我会重点帮你在这方面提升！」
  - 无试卷数据时：「[科目]还没有试卷数据，你觉得自己[科目]哪方面需要加强呢？」
  - 全部无试卷时：「我还不太了解你的学习情况，不过没关系！告诉我你想重点加强哪些方面，我来帮你安排~」
- **智能推荐**：AI 根据试卷诊断结果 + 自选学习方向，综合推荐时间安排和科目分配比例，并语音解释推荐理由
- **实时反馈**：用户每次调整控件，AI老师实时给出评价（如"数学薄弱，建议不要减少数学时间哦"）
- **冲突提醒**：当选择的时间段与已知的线下课程冲突时，AI老师主动提醒并建议替代方案
- **语音播报**：所有AI对话内容自动语音播报，支持点击气泡重播

## 状态枚举

### 默认状态
- 步骤 1 学情总览展示：
  - 有试卷数据的科目显示诊断摘要卡片
  - 无试卷数据的科目显示自选学习方向选择器
- 步骤 2-4 根据诊断数据 + 自选方向预填推荐方案
- 时间网格中AI推荐时段已高亮
- 科目滑块已预设推荐值（固定为语文、数学、英语三科）
- 测评频率已预选AI推荐项
- 底部确认按钮可点击

### 空状态（无任何试卷数据时）
- AI老师引导：「我还不太了解你的学习情况，不过没关系！告诉我你想重点加强哪些方面，我来帮你安排~」
- 步骤 1 三科全部显示自选学习方向选择器
- 学生完成自选后，后续步骤根据自选方向生成推荐方案
- 时间网格和科目滑块使用均衡默认方案（若学生选了「我不确定」）

### 加载状态
- 数字人老师播放"思考"动画（眨眼、手托下巴）
- 时间网格区域显示骨架屏
- 科目滑块区域显示加载占位符
- 加载文案："正在为你生成最佳学习方案…"

### 错误状态
- **网络异常**：AI老师显示遗憾表情，对话气泡显示"网络不太好，我先把之前的推荐保存下来，你也可以手动调整"，控件切换为纯手动模式
- **数据异常**：若试卷诊断数据解析失败，AI老师提示"试卷数据好像有点问题，我们先手动设置吧"，该科目回退为自选学习方向模式

### 边界情况
- **时间选择过少**：当周总时长低于5小时，AI老师温和提醒"每周学习时间有点少哦，要不要再加一些？"，确认按钮显示警告色但仍可点击
- **时间选择过多**：当周总时长超过30小时，AI老师关切提醒"学习也要注意休息哦，建议每周不超过25小时"
- **科目分配极端**：某科目分配超过总时长60%时，AI老师提醒均衡学习的重要性
- **家长模式**：家长模式下额外显示"锁定计划"开关，开启后学生无法自行修改计划
- **已有计划**：若已存在学习计划，页面标题变为"调整学习计划"，加载已有计划数据供修改
- **部分科目有数据**：诊断摘要和自选方向在同一页面混合展示，AI 按科目逐个引导

## 导航关系

### 从哪来
- **A4 试卷拍照上传**：选择「我没有试卷」直接跳转（无试卷数据，三科走自选流程）
- **A4 试卷拍照上传**：多科目上传完成后跳转（携带已上传科目的诊断数据）
- **B1 学生首页**：点击"创建学习计划"入口卡片
- **B2 家长首页**：点击"为孩子创建计划"入口

### 到哪去
- **C2 学习计划总览**：确认生成计划后，携带完整计划数据跳转，显示成功toast"学习计划已生成"
- **返回上一页**：点击左上角返回，若有未保存修改弹出确认弹窗"还没保存哦，确定离开吗？"
